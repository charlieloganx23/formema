================================================================================
        GUIA DE CRIA√á√ÉO DOS BOT√ïES DE CACHE E ATUALIZA√á√ÉO DO SISTEMA
================================================================================

Data: 08/12/2025
Sistema: EMATECH - EMATER-RO
Arquivo Base: index.html + script.js
Objetivo: Criar bot√µes de atualiza√ß√£o e limpeza de cache para PWAs

================================================================================
√çNDICE
================================================================================

1. VIS√ÉO GERAL DOS BOT√ïES
2. ESTRUTURA HTML COMPLETA
3. CSS COMPLETO (Estilos e Anima√ß√µes)
4. JAVASCRIPT - FUN√á√ÉO ATUALIZAR SISTEMA
5. JAVASCRIPT - FUN√á√ÉO LIMPAR CACHE
6. INTEGRA√á√ÉO COM SERVICE WORKER
7. PASSO A PASSO DE IMPLEMENTA√á√ÉO
8. EXEMPLOS DE C√ìDIGO PRONTOS
9. TROUBLESHOOTING
10. BOAS PR√ÅTICAS

================================================================================
1. VIS√ÉO GERAL DOS BOT√ïES
================================================================================

COMPONENTES VISUAIS:
--------------------

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [üîÑ Sincronizar] (0)  [üîÑ Atualizar]  [üóëÔ∏è Limpar Cache]   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DESCRI√á√ÉO DOS BOT√ïES:
----------------------

1Ô∏è‚É£ BOT√ÉO SINCRONIZAR (Verde Transl√∫cido)
   - Fun√ß√£o: Sincronizar dados pendentes com servidor
   - Cor: rgba(255, 255, 255, 0.3) - fundo transl√∫cido
   - Badge: Contador vermelho de formul√°rios pendentes
   - Uso: Frequente durante o dia

2Ô∏è‚É£ BOT√ÉO ATUALIZAR (Laranja #ff9800)
   - Fun√ß√£o: For√ßar atualiza√ß√£o completa do sistema (hard refresh)
   - Limpa cache do navegador
   - Atualiza Service Worker
   - Recarrega p√°gina sem cache
   - Uso: Quando houver nova vers√£o do sistema

3Ô∏è‚É£ BOT√ÉO LIMPAR CACHE (Vermelho #f44336)
   - Fun√ß√£o: Limpeza emergencial completa
   - Remove TODOS os caches
   - Desregistra Service Worker
   - PRESERVA dados do IndexedDB
   - Uso: Problemas graves de cache

QUANDO USAR CADA BOT√ÉO:
------------------------

üìã Sincronizar:
   - Ap√≥s preencher formul√°rios offline
   - Periodicamente durante o dia
   - Antes de desligar o tablet

üîÑ Atualizar:
   - Ap√≥s deploy de nova vers√£o
   - Sistema carregando vers√£o antiga
   - Mudan√ßas visuais n√£o aparecem
   - Service Worker n√£o atualiza

üóëÔ∏è Limpar Cache:
   - Sistema completamente quebrado
   - Arquivos antigos persistindo
   - Erros JavaScript recorrentes
   - √öltima op√ß√£o (emerg√™ncia)

================================================================================
2. ESTRUTURA HTML COMPLETA
================================================================================

<!-- Adicionar no header, ap√≥s contador de question√°rios -->

<div class="header-info">
    
    <!-- Status Online/Offline -->
    <div id="status-indicator" class="status-badge">
        <span style="color: #2e7d32;">‚óè</span> Online
    </div>
    
    <!-- Status GPS (Opcional) -->
    <div id="geo-status" class="geo-badge">
        <span style="color: #666;">üìç GPS aguardando... (opcional)</span>
    </div>
    
    <!-- Contador de Formul√°rios -->
    <div class="contador-sessao">
        <span>üìã</span>
        <span id="contador-questionarios">0</span>
        <span class="contador-label">aplicados</span>
    </div>
    
    <!-- GRUPO 1: Bot√£o de Sincroniza√ß√£o -->
    <div class="sync-controls">
        <button type="button" 
                id="btn-sync-manual" 
                class="btn-sync" 
                onclick="sincronizarManual()" 
                title="Sincronizar dados pendentes com o servidor">
            üîÑ Sincronizar
        </button>
        <!-- Badge de pendentes (aparece dinamicamente) -->
        <span id="badge-sync" class="badge-pendente" style="display: none;">0</span>
    </div>
    
    <!-- GRUPO 2: Bot√µes de Cache e Atualiza√ß√£o -->
    <div class="sync-controls" style="margin-left: 10px;">
        
        <!-- Bot√£o Atualizar Sistema (Laranja) -->
        <button type="button" 
                class="btn-sync" 
                onclick="forceHardRefresh()" 
                title="For√ßar atualiza√ß√£o completa do sistema (limpa cache)" 
                style="background: #ff9800;">
            üîÑ Atualizar
        </button>
        
        <!-- Bot√£o Limpar Cache (Vermelho) -->
        <button type="button" 
                class="btn-sync" 
                onclick="limparCacheCompleto()" 
                title="Limpar cache e dados (emerg√™ncia - preserva formul√°rios)" 
                style="background: #f44336; font-size: 11px;">
            üóëÔ∏è Limpar Cache
        </button>
        
    </div>
    
</div>

ANATOMIA DO HTML:
-----------------

<div class="sync-controls" style="margin-left: 10px;">
    ‚îÇ
    ‚îú‚îÄ‚îÄ <button onclick="forceHardRefresh()" style="background: #ff9800;">
    ‚îÇ   ‚îÇ   ‚îî‚îÄ Cor laranja customizada
    ‚îÇ   ‚îî‚îÄ Fun√ß√£o: Atualizar sistema
    ‚îÇ
    ‚îî‚îÄ‚îÄ <button onclick="limparCacheCompleto()" style="background: #f44336;">
        ‚îÇ   ‚îî‚îÄ Cor vermelha customizada
        ‚îî‚îÄ Fun√ß√£o: Limpar cache completo

ATRIBUTOS IMPORTANTES:
----------------------
- type="button" ‚Üí Prevenir submit de formul√°rio
- class="btn-sync" ‚Üí Estilo base do bot√£o
- onclick="funcao()" ‚Üí A√ß√£o ao clicar
- title="..." ‚Üí Tooltip explicativo
- style="background: #cor;" ‚Üí Cor customizada inline

================================================================================
3. CSS COMPLETO (Estilos e Anima√ß√µes)
================================================================================

/* ============================================================
   CONTAINER DOS BOT√ïES (sync-controls)
   ============================================================ */

.sync-controls {
    position: relative;           /* Para badge absoluto */
    display: inline-flex;         /* Flexbox inline */
    align-items: center;          /* Centralizar verticalmente */
    gap: 10px;                    /* Espa√ßo entre elementos */
}


/* ============================================================
   ESTILO BASE DO BOT√ÉO (btn-sync)
   ============================================================ */

.btn-sync {
    /* Fundo e Borda */
    background: rgba(255, 255, 255, 0.3);    /* Fundo transl√∫cido */
    border: 1px solid rgba(255, 255, 255, 0.5);  /* Borda branca 50% */
    backdrop-filter: blur(10px);              /* Efeito glassmorphism */
    
    /* Cor e Texto */
    color: white;                             /* Texto branco */
    font-size: 0.9em;                         /* Tamanho menor */
    font-weight: 500;                         /* Meio-negrito */
    
    /* Espa√ßamento */
    padding: 8px 16px;                        /* Padding compacto */
    border-radius: 20px;                      /* Bordas arredondadas */
    
    /* Intera√ß√£o */
    cursor: pointer;                          /* Cursor pointer */
    transition: all 0.3s ease;                /* Transi√ß√µes suaves */
}

/* Hover Effect */
.btn-sync:hover {
    background: rgba(255, 255, 255, 0.4);     /* Fundo mais claro */
    transform: translateY(-2px);              /* Elevar bot√£o */
}

/* Estado Desabilitado */
.btn-sync:disabled {
    opacity: 0.6;                             /* Opacidade reduzida */
    cursor: not-allowed;                      /* Cursor bloqueado */
}


/* ============================================================
   BADGE DE PENDENTES (contador vermelho)
   ============================================================ */

.badge-pendente {
    /* Posicionamento */
    position: absolute;                       /* Absoluto ao pai */
    top: -8px;                                /* 8px acima */
    right: -8px;                              /* 8px √† direita */
    
    /* Apar√™ncia */
    background: #f44336;                      /* Vermelho Material */
    color: white;                             /* Texto branco */
    border-radius: 50%;                       /* C√≠rculo perfeito */
    width: 24px;                              /* Largura fixa */
    height: 24px;                             /* Altura fixa */
    
    /* Layout Interno */
    display: flex;                            /* Flexbox */
    align-items: center;                      /* Centralizar verticalmente */
    justify-content: center;                  /* Centralizar horizontalmente */
    
    /* Texto */
    font-size: 0.75em;                        /* Texto pequeno */
    font-weight: bold;                        /* Negrito */
    
    /* Efeitos */
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);    /* Sombra sutil */
    animation: pulse 2s infinite;             /* Anima√ß√£o pulsante */
}

/* Anima√ß√£o Pulsante */
@keyframes pulse {
    0%, 100% {
        transform: scale(1);                  /* Tamanho normal */
    }
    50% {
        transform: scale(1.1);                /* Aumentar 10% */
    }
}


/* ============================================================
   VARIANTES DE CORES (inline styles)
   ============================================================ */

/* 
   Laranja (Atualizar): style="background: #ff9800;"
   Vermelho (Limpar): style="background: #f44336;"
   
   Aplicar diretamente no HTML para sobrescrever o padr√£o
*/

/* Hover em bot√µes customizados */
.btn-sync[style*="background: #ff9800"]:hover {
    background: #fb8c00 !important;           /* Laranja mais escuro */
}

.btn-sync[style*="background: #f44336"]:hover {
    background: #e53935 !important;           /* Vermelho mais escuro */
}


/* ============================================================
   RESPONSIVIDADE MOBILE
   ============================================================ */

@media (max-width: 768px) {
    .sync-controls {
        gap: 6px;                             /* Espa√ßo menor */
    }
    
    .btn-sync {
        padding: 6px 12px;                    /* Padding reduzido */
        font-size: 0.8em;                     /* Fonte menor */
    }
    
    .badge-pendente {
        width: 20px;                          /* Badge menor */
        height: 20px;
        font-size: 0.7em;
        top: -6px;
        right: -6px;
    }
}

@media (max-width: 480px) {
    .btn-sync {
        padding: 5px 10px;                    /* Ainda menor */
        font-size: 0.75em;
    }
    
    /* Esconder texto, mostrar s√≥ emoji em mobile */
    .btn-sync {
        font-size: 1.2em;
    }
}

================================================================================
4. JAVASCRIPT - FUN√á√ÉO ATUALIZAR SISTEMA
================================================================================

/**
 * Fun√ß√£o: forceHardRefresh()
 * Prop√≥sito: For√ßar atualiza√ß√£o completa do sistema (hard refresh)
 * 
 * O que faz:
 * 1. Mostra feedback visual ao usu√°rio
 * 2. Limpa TODOS os caches do Service Worker
 * 3. Envia mensagem para SW atualizar
 * 4. Recarrega p√°gina sem cache
 * 
 * Quando usar:
 * - Nova vers√£o do sistema dispon√≠vel
 * - Sistema carregando arquivos antigos
 * - Service Worker n√£o atualiza automaticamente
 */

function forceHardRefresh() {
    console.log('üîÑ For√ßando hard refresh...');
    
    // =========================================================
    // PASSO 1: Mostrar Feedback Visual
    // =========================================================
    
    const feedback = document.createElement('div');
    feedback.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #1976d2, #2196f3);
        color: white;
        padding: 30px 40px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        z-index: 99999;
        text-align: center;
        font-size: 18px;
        font-weight: 600;
    `;
    feedback.innerHTML = `
        üîÑ Atualizando sistema...<br>
        <small style="font-weight: 400; font-size: 14px; opacity: 0.9;">
            Aguarde...
        </small>
    `;
    document.body.appendChild(feedback);
    
    
    // =========================================================
    // PASSO 2: Limpar Caches do Service Worker
    // =========================================================
    
    if ('caches' in window) {
        // Listar todos os caches
        caches.keys().then(cacheNames => {
            console.log('üóëÔ∏è Limpando caches:', cacheNames);
            
            // Deletar cada cache
            return Promise.all(
                cacheNames.map(cacheName => {
                    console.log('  - Deletando cache:', cacheName);
                    return caches.delete(cacheName);
                })
            );
        })
        .then(() => {
            console.log('‚úÖ Todos os caches limpos');
            
            
            // =========================================================
            // PASSO 3: Atualizar Service Worker
            // =========================================================
            
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                // Enviar mensagem para SW pular espera e ativar imediatamente
                navigator.serviceWorker.controller.postMessage({ 
                    type: 'SKIP_WAITING' 
                });
                console.log('üì® Mensagem enviada para Service Worker');
            }
            
            
            // =========================================================
            // PASSO 4: Recarregar P√°gina SEM Cache
            // =========================================================
            
            setTimeout(() => {
                // location.reload(true) = hard reload (bypass cache)
                window.location.reload(true);
            }, 500);
        })
        .catch(error => {
            console.error('‚ùå Erro ao limpar cache:', error);
            alert('Erro ao atualizar. Tente novamente.');
        });
    } 
    else {
        // Navegador n√£o suporta Cache API
        // Apenas recarregar
        console.warn('‚ö†Ô∏è Cache API n√£o dispon√≠vel');
        setTimeout(() => {
            window.location.reload(true);
        }, 500);
    }
}


// =========================================================
// VARIA√á√ÉO ALTERNATIVA (com Promise.finally)
// =========================================================

async function forceHardRefreshAsync() {
    console.log('üîÑ Iniciando hard refresh...');
    
    try {
        // Limpar caches
        if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            console.log('‚úÖ Caches limpos');
        }
        
        // Atualizar Service Worker
        if ('serviceWorker' in navigator) {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
                await registration.update();
                console.log('‚úÖ Service Worker atualizado');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro:', error);
    } finally {
        // Sempre recarregar (mesmo se houver erro)
        window.location.reload(true);
    }
}

================================================================================
5. JAVASCRIPT - FUN√á√ÉO LIMPAR CACHE
================================================================================

/**
 * Fun√ß√£o: limparCacheCompleto()
 * Prop√≥sito: Limpeza emergencial completa do sistema
 * 
 * O que faz:
 * 1. Pede confirma√ß√£o ao usu√°rio (cr√≠tico!)
 * 2. Limpa sessionStorage (dados tempor√°rios)
 * 3. Desregistra TODOS os Service Workers
 * 4. Deleta TODOS os caches
 * 5. Recarrega p√°gina com par√¢metro nocache
 * 
 * O que PRESERVA:
 * - IndexedDB (formul√°rios e dados)
 * - localStorage (configura√ß√µes)
 * 
 * Quando usar:
 * - Sistema completamente quebrado
 * - Arquivos antigos persistindo ap√≥s v√°rias tentativas
 * - √öltima op√ß√£o (emerg√™ncia)
 */

function limparCacheCompleto() {
    
    // =========================================================
    // PASSO 1: Confirmar com Usu√°rio (CR√çTICO)
    // =========================================================
    
    const confirmacao = confirm(
        '‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√°:\n\n' +
        'üóëÔ∏è Limpar TODO o cache do sistema\n' +
        'üóëÔ∏è Desregistrar Service Worker\n' +
        'üóëÔ∏è Remover arquivos em cache\n\n' +
        '‚úÖ PRESERVAR:\n' +
        'üìã Formul√°rios no IndexedDB\n' +
        'üíæ Dados pendentes de sincroniza√ß√£o\n\n' +
        'Use esta op√ß√£o se o sistema estiver carregando arquivos antigos.\n\n' +
        'Deseja continuar?'
    );
    
    if (!confirmacao) {
        console.log('‚ùå Limpeza de cache cancelada pelo usu√°rio');
        return;
    }
    
    console.log('üóëÔ∏è Iniciando limpeza completa de cache...');
    
    
    // =========================================================
    // PASSO 2: Mostrar Feedback Visual
    // =========================================================
    
    const feedback = document.createElement('div');
    feedback.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #f44336, #e91e63);
        color: white;
        padding: 30px 40px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        z-index: 99999;
        text-align: center;
        font-size: 18px;
        font-weight: 600;
    `;
    feedback.innerHTML = `
        üóëÔ∏è Limpando cache...<br>
        <small style="font-weight: 400; font-size: 14px; opacity: 0.9;">
            Dados preservados
        </small>
    `;
    document.body.appendChild(feedback);
    
    
    // =========================================================
    // PASSO 3: Limpar SessionStorage
    // =========================================================
    
    try {
        sessionStorage.clear();
        console.log('‚úÖ SessionStorage limpo');
    } catch (error) {
        console.warn('‚ö†Ô∏è Erro ao limpar sessionStorage:', error);
    }
    
    
    // =========================================================
    // PASSO 4: Desregistrar Service Workers
    // =========================================================
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
            console.log('üóëÔ∏è Desregistrando Service Workers:', registrations.length);
            
            registrations.forEach(registration => {
                registration.unregister()
                    .then(success => {
                        if (success) {
                            console.log('‚úÖ Service Worker desregistrado');
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Erro ao desregistrar SW:', error);
                    });
            });
        });
    }
    
    
    // =========================================================
    // PASSO 5: Deletar TODOS os Caches
    // =========================================================
    
    if ('caches' in window) {
        caches.keys().then(cacheNames => {
            console.log('üóëÔ∏è Deletando caches:', cacheNames);
            
            return Promise.all(
                cacheNames.map(cacheName => {
                    console.log('  - Deletando cache:', cacheName);
                    return caches.delete(cacheName);
                })
            );
        })
        .then(() => {
            console.log('‚úÖ Todos os caches deletados');
            
            // Atualizar feedback
            feedback.innerHTML = `
                ‚úÖ Cache limpo!<br>
                <small style="font-weight: 400; font-size: 14px;">
                    Recarregando...
                </small>
            `;
            
            
            // =========================================================
            // PASSO 6: Recarregar com Par√¢metro NoCache
            // =========================================================
            
            setTimeout(() => {
                // Adicionar timestamp para for√ßar bypass de cache
                const timestamp = Date.now();
                window.location.href = window.location.href + '?nocache=' + timestamp;
            }, 1000);
        })
        .catch(error => {
            console.error('‚ùå Erro ao deletar caches:', error);
            alert('Erro ao limpar cache. Tente novamente.');
        });
    } 
    else {
        // Navegador n√£o suporta Cache API
        console.warn('‚ö†Ô∏è Cache API n√£o dispon√≠vel');
        setTimeout(() => {
            window.location.href = window.location.href + '?nocache=' + Date.now();
        }, 1000);
    }
}


// =========================================================
// VARIA√á√ÉO COM LIMPEZA TOTAL (Incluindo localStorage)
// =========================================================

function limparCacheTotalEmergencia() {
    const confirmacao = confirm(
        'üö® ATEN√á√ÉO CR√çTICA! üö®\n\n' +
        'Esta a√ß√£o IR√Å DELETAR:\n' +
        '‚ùå TODO o cache\n' +
        '‚ùå Configura√ß√µes (localStorage)\n' +
        '‚ùå Dados tempor√°rios (sessionStorage)\n' +
        '‚ùå Service Workers\n\n' +
        '‚úÖ PRESERVAR:\n' +
        'üìã Formul√°rios no IndexedDB apenas\n\n' +
        'USE APENAS EM EMERG√äNCIA EXTREMA!\n\n' +
        'Confirmar limpeza total?'
    );
    
    if (!confirmacao) return;
    
    // Limpar tudo
    sessionStorage.clear();
    localStorage.clear();  // ‚ö†Ô∏è CUIDADO: Remove configura√ß√µes!
    
    // Desregistrar SW
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
            regs.forEach(reg => reg.unregister());
        });
    }
    
    // Deletar caches
    if ('caches' in window) {
        caches.keys().then(names => {
            Promise.all(names.map(name => caches.delete(name)))
                .then(() => {
                    alert('‚úÖ Limpeza total conclu√≠da!\n\nO sistema ser√° recarregado.');
                    window.location.href = window.location.origin + '?reset=' + Date.now();
                });
        });
    }
}

================================================================================
6. INTEGRA√á√ÉO COM SERVICE WORKER
================================================================================

// =========================================================
// NO SERVICE WORKER (service-worker.js)
// =========================================================

// Escutar mensagens do cliente
self.addEventListener('message', (event) => {
    console.log('üì® Service Worker recebeu mensagem:', event.data);
    
    if (event.data && event.data.type === 'SKIP_WAITING') {
        console.log('‚è≠Ô∏è Pulando espera e ativando imediatamente...');
        self.skipWaiting();
    }
    
    if (event.data && event.data.type === 'CLEAR_CACHE') {
        console.log('üóëÔ∏è Limpando cache via mensagem...');
        
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames.map(cacheName => {
                    console.log('  - Deletando:', cacheName);
                    return caches.delete(cacheName);
                })
            );
        }).then(() => {
            console.log('‚úÖ Caches limpos pelo SW');
            event.ports[0].postMessage({ success: true });
        });
    }
});

// Ativa√ß√£o: Limpar caches antigos
self.addEventListener('activate', (event) => {
    console.log('üîÑ Service Worker ativando...');
    
    const currentCaches = ['ematech-v9', 'ematech-images-v9'];
    
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames.map(cacheName => {
                    if (!currentCaches.includes(cacheName)) {
                        console.log('üóëÔ∏è Deletando cache antigo:', cacheName);
                        return caches.delete(cacheName);
                    }
                })
            );
        }).then(() => {
            console.log('‚úÖ Caches antigos limpos');
            return self.clients.claim();
        })
    );
});


// =========================================================
// NO CLIENTE (script.js) - Detectar Atualiza√ß√£o Dispon√≠vel
// =========================================================

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
        .then(registration => {
            console.log('‚úÖ Service Worker registrado');
            
            // Verificar atualiza√ß√µes a cada 5 minutos
            setInterval(() => {
                registration.update();
            }, 5 * 60 * 1000);
            
            // Escutar evento de nova vers√£o
            registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('üÜï Nova vers√£o detectada!');
                
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // Nova vers√£o pronta
                        mostrarNotificacaoAtualizacao();
                    }
                });
            });
        });
}

function mostrarNotificacaoAtualizacao() {
    const notificacao = document.createElement('div');
    notificacao.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        color: white;
        padding: 20px 25px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        z-index: 99999;
        animation: slideIn 0.5s ease;
    `;
    notificacao.innerHTML = `
        <div style="font-weight: 600; font-size: 16px; margin-bottom: 10px;">
            üéâ Nova vers√£o dispon√≠vel!
        </div>
        <div style="font-size: 14px; margin-bottom: 15px;">
            Atualize para obter as √∫ltimas melhorias.
        </div>
        <button onclick="forceHardRefresh()" style="
            background: white;
            color: #4caf50;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        ">
            üîÑ Atualizar Agora
        </button>
        <button onclick="this.parentElement.remove()" style="
            background: transparent;
            color: white;
            border: 1px solid white;
            padding: 8px 20px;
            border-radius: 6px;
            margin-left: 10px;
            cursor: pointer;
        ">
            Depois
        </button>
    `;
    document.body.appendChild(notificacao);
}

================================================================================
7. PASSO A PASSO DE IMPLEMENTA√á√ÉO
================================================================================

CHECKLIST COMPLETO:
-------------------

‚ñ° ETAPA 1: ADICIONAR HTML
   ‚ñ° Copiar estrutura dos bot√µes para o header
   ‚ñ° Posicionar ap√≥s contador de question√°rios
   ‚ñ° Verificar classes CSS aplicadas
   ‚ñ° Adicionar atributos title (tooltips)
   ‚ñ° Configurar cores inline (background)

‚ñ° ETAPA 2: ADICIONAR CSS
   ‚ñ° Copiar estilos .sync-controls
   ‚ñ° Copiar estilos .btn-sync (base + hover + disabled)
   ‚ñ° Copiar estilos .badge-pendente
   ‚ñ° Copiar anima√ß√£o @keyframes pulse
   ‚ñ° Adicionar media queries para responsividade
   ‚ñ° Testar em diferentes tamanhos de tela

‚ñ° ETAPA 3: ADICIONAR JAVASCRIPT - ATUALIZAR
   ‚ñ° Criar fun√ß√£o forceHardRefresh()
   ‚ñ° Implementar feedback visual (modal)
   ‚ñ° Adicionar limpeza de caches
   ‚ñ° Integrar com Service Worker (postMessage)
   ‚ñ° Implementar reload com bypass de cache
   ‚ñ° Adicionar tratamento de erros

‚ñ° ETAPA 4: ADICIONAR JAVASCRIPT - LIMPAR
   ‚ñ° Criar fun√ß√£o limparCacheCompleto()
   ‚ñ° Adicionar confirma√ß√£o do usu√°rio (confirm)
   ‚ñ° Implementar feedback visual
   ‚ñ° Limpar sessionStorage
   ‚ñ° Desregistrar Service Workers
   ‚ñ° Deletar todos os caches
   ‚ñ° Recarregar com par√¢metro nocache

‚ñ° ETAPA 5: INTEGRAR COM SERVICE WORKER
   ‚ñ° Adicionar listener de mensagens no SW
   ‚ñ° Implementar SKIP_WAITING
   ‚ñ° Implementar CLEAR_CACHE (opcional)
   ‚ñ° Adicionar limpeza de caches antigos na ativa√ß√£o
   ‚ñ° Implementar self.clients.claim()

‚ñ° ETAPA 6: DETECTAR ATUALIZA√á√ïES
   ‚ñ° Registrar Service Worker com verifica√ß√£o peri√≥dica
   ‚ñ° Escutar evento 'updatefound'
   ‚ñ° Criar notifica√ß√£o visual de atualiza√ß√£o
   ‚ñ° Adicionar bot√£o "Atualizar Agora"
   ‚ñ° Permitir adiar atualiza√ß√£o

‚ñ° ETAPA 7: TESTAR FUNCIONALIDADES
   ‚ñ° Testar bot√£o Atualizar (hard refresh)
   ‚ñ° Testar bot√£o Limpar Cache (confirma√ß√£o)
   ‚ñ° Verificar preserva√ß√£o de dados IndexedDB
   ‚ñ° Validar limpeza de caches
   ‚ñ° Testar desregistro de Service Worker
   ‚ñ° Confirmar reload funcionando

‚ñ° ETAPA 8: TESTAR CEN√ÅRIOS
   ‚ñ° Sistema com caches antigos
   ‚ñ° Nova vers√£o do Service Worker
   ‚ñ° M√∫ltiplos caches acumulados
   ‚ñ° Offline ‚Üí Online ‚Üí Atualizar
   ‚ñ° Dados pendentes no IndexedDB
   ‚ñ° Mobile (touch, tamanho de tela)

‚ñ° ETAPA 9: VALIDAR UX
   ‚ñ° Feedbacks visuais claros
   ‚ñ° Confirma√ß√µes apropriadas
   ‚ñ° Tooltips explicativos
   ‚ñ° Cores intuitivas (laranja/vermelho)
   ‚ñ° Anima√ß√µes suaves
   ‚ñ° Responsividade mobile

‚ñ° ETAPA 10: DOCUMENTA√á√ÉO
   ‚ñ° Comentar c√≥digo JavaScript
   ‚ñ° Documentar quando usar cada bot√£o
   ‚ñ° Criar guia para usu√°rios finais
   ‚ñ° Listar troubleshooting comum
   ‚ñ° Registrar decis√µes de design

================================================================================
8. EXEMPLOS DE C√ìDIGO PRONTOS
================================================================================

EXEMPLO 1: IMPLEMENTA√á√ÉO M√çNIMA (Apenas Atualizar)
---------------------------------------------------

<!-- HTML -->
<button onclick="forceRefresh()" style="background: #ff9800; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">
    üîÑ Atualizar Sistema
</button>

<!-- JavaScript -->
<script>
function forceRefresh() {
    if (confirm('Atualizar sistema agora?')) {
        if ('caches' in window) {
            caches.keys().then(names => {
                Promise.all(names.map(n => caches.delete(n)))
                    .then(() => window.location.reload(true));
            });
        } else {
            window.location.reload(true);
        }
    }
}
</script>


EXEMPLO 2: COM FEEDBACK VISUAL SIMPLES
---------------------------------------

function forceHardRefresh() {
    // Mostrar loading
    const loading = document.getElementById('loading');
    loading.style.display = 'block';
    loading.textContent = 'üîÑ Atualizando...';
    
    // Limpar cache
    if ('caches' in window) {
        caches.keys().then(names => {
            return Promise.all(names.map(name => caches.delete(name)));
        }).then(() => {
            loading.textContent = '‚úÖ Conclu√≠do!';
            setTimeout(() => {
                window.location.reload(true);
            }, 500);
        });
    }
}


EXEMPLO 3: ASYNC/AWAIT (Moderno)
---------------------------------

async function forceHardRefresh() {
    try {
        console.log('üîÑ Iniciando atualiza√ß√£o...');
        
        // Limpar caches
        if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            console.log('‚úÖ Caches limpos');
        }
        
        // Atualizar Service Worker
        if ('serviceWorker' in navigator) {
            const reg = await navigator.serviceWorker.getRegistration();
            if (reg) await reg.update();
        }
        
        // Recarregar
        window.location.reload(true);
        
    } catch (error) {
        console.error('‚ùå Erro:', error);
        alert('Erro ao atualizar. Tente novamente.');
    }
}


EXEMPLO 4: COM NOTIFICA√á√ÉO TOAST
---------------------------------

function mostrarToast(mensagem, cor = '#4caf50') {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: ${cor};
        color: white;
        padding: 15px 30px;
        border-radius: 50px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 99999;
        animation: fadeInUp 0.3s ease;
    `;
    toast.textContent = mensagem;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function forceHardRefresh() {
    mostrarToast('üîÑ Atualizando sistema...', '#2196f3');
    
    if ('caches' in window) {
        caches.keys().then(names => {
            return Promise.all(names.map(n => caches.delete(n)));
        }).then(() => {
            mostrarToast('‚úÖ Cache limpo!', '#4caf50');
            setTimeout(() => window.location.reload(true), 1000);
        });
    }
}


EXEMPLO 5: COM PROGRESS BAR
----------------------------

async function limparCacheComProgresso() {
    const modal = criarModalProgresso();
    document.body.appendChild(modal);
    
    try {
        // Etapa 1
        atualizarProgresso(modal, 25, 'Limpando sessionStorage...');
        sessionStorage.clear();
        await sleep(500);
        
        // Etapa 2
        atualizarProgresso(modal, 50, 'Desregistrando Service Workers...');
        const regs = await navigator.serviceWorker.getRegistrations();
        await Promise.all(regs.map(r => r.unregister()));
        await sleep(500);
        
        // Etapa 3
        atualizarProgresso(modal, 75, 'Deletando caches...');
        const names = await caches.keys();
        await Promise.all(names.map(n => caches.delete(n)));
        await sleep(500);
        
        // Etapa 4
        atualizarProgresso(modal, 100, 'Conclu√≠do! Recarregando...');
        await sleep(1000);
        
        window.location.reload(true);
        
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro na limpeza. Tente novamente.');
        modal.remove();
    }
}

function criarModalProgresso() {
    const modal = document.createElement('div');
    modal.innerHTML = `
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); z-index: 99999; min-width: 300px;">
            <div id="progress-text" style="font-weight: 600; margin-bottom: 15px;">Iniciando...</div>
            <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="progress-bar" style="background: linear-gradient(90deg, #4caf50, #66bb6a); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
            </div>
        </div>
    `;
    return modal;
}

function atualizarProgresso(modal, percent, texto) {
    modal.querySelector('#progress-bar').style.width = percent + '%';
    modal.querySelector('#progress-text').textContent = texto;
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}


EXEMPLO 6: BOT√ÉO COM CONTADOR REGRESSIVO
-----------------------------------------

function limparCacheComContador() {
    let segundos = 5;
    
    const confirmacao = confirm(
        '‚ö†Ô∏è Limpar cache completo?\n\n' +
        'Esta a√ß√£o levar√° ' + segundos + ' segundos.\n\n' +
        'Confirmar?'
    );
    
    if (!confirmacao) return;
    
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #f44336; color: white; padding: 30px; border-radius: 12px; z-index: 99999; text-align: center; font-size: 24px; font-weight: bold;';
    modal.textContent = segundos;
    document.body.appendChild(modal);
    
    const intervalo = setInterval(() => {
        segundos--;
        modal.textContent = segundos;
        
        if (segundos === 0) {
            clearInterval(intervalo);
            modal.textContent = 'üóëÔ∏è Limpando...';
            
            // Executar limpeza
            limparCacheCompleto();
        }
    }, 1000);
}

================================================================================
9. TROUBLESHOOTING
================================================================================

PROBLEMA 1: Bot√£o n√£o limpa cache
----------------------------------
CAUSA: Cache API n√£o dispon√≠vel ou erro na promise
SOLU√á√ÉO:
- Verificar console.log para erros
- Testar em HTTPS (required para SW)
- Adicionar fallback para navegadores antigos
- Verificar permiss√µes do navegador

if ('caches' in window) {
    // OK
} else {
    console.error('Cache API n√£o dispon√≠vel');
    alert('Seu navegador n√£o suporta esta funcionalidade');
}


PROBLEMA 2: Service Worker n√£o atualiza
----------------------------------------
CAUSA: SW em estado "waiting" ou n√£o recebe mensagem
SOLU√á√ÉO:
- Verificar se postMessage est√° funcionando
- Adicionar skipWaiting() no SW
- For√ßar registration.update()
- Limpar dados do Application tab (DevTools)

// No Service Worker
self.addEventListener('message', event => {
    if (event.data.type === 'SKIP_WAITING') {
        self.skipWaiting();
    }
});


PROBLEMA 3: Dados perdidos ap√≥s limpeza
----------------------------------------
CAUSA: Limpando localStorage ou IndexedDB por engano
SOLU√á√ÉO:
- N√ÉO limpar localStorage (configura√ß√µes)
- N√ÉO limpar IndexedDB (formul√°rios)
- Apenas limpar caches e sessionStorage
- Avisar usu√°rio claramente no confirm()


PROBLEMA 4: P√°gina n√£o recarrega
---------------------------------
CAUSA: Erro no reload ou cache ainda ativo
SOLU√á√ÉO:
- Usar window.location.reload(true) para hard reload
- Adicionar par√¢metro nocache: window.location.href + '?t=' + Date.now()
- Verificar se n√£o h√° erro JavaScript bloqueando

// Sempre funciona
window.location.href = window.location.href.split('?')[0] + '?nocache=' + Date.now();


PROBLEMA 5: Bot√µes n√£o aparecem no mobile
------------------------------------------
CAUSA: Espa√ßo insuficiente ou overflow hidden
SOLU√á√ÉO:
- Reduzir padding nos bot√µes
- Esconder texto, mostrar s√≥ emoji
- Usar menu dropdown para op√ß√µes
- Implementar scroll horizontal

@media (max-width: 480px) {
    .btn-sync span {
        display: none; /* Esconder texto */
    }
}


PROBLEMA 6: Feedback visual n√£o aparece
----------------------------------------
CAUSA: Z-index baixo ou elemento removido cedo demais
SOLU√á√ÉO:
- Usar z-index: 99999
- Adicionar !important se necess√°rio
- Verificar se elemento foi adicionado ao body
- N√£o remover antes do reload

feedback.style.zIndex = '99999';
document.body.appendChild(feedback);


PROBLEMA 7: Confirma√ß√£o ignorada
---------------------------------
CAUSA: confirm() bloqueado ou prompt ignorado
SOLU√á√ÉO:
- Usar modal customizado (mais moderno)
- Verificar se pop-ups n√£o est√£o bloqueados
- Adicionar callback de confirma√ß√£o

function confirmarAcao(mensagem, callback) {
    const modal = criarModalConfirmacao(mensagem);
    modal.querySelector('.btn-confirmar').onclick = () => {
        modal.remove();
        callback(true);
    };
    modal.querySelector('.btn-cancelar').onclick = () => {
        modal.remove();
        callback(false);
    };
    document.body.appendChild(modal);
}


PROBLEMA 8: Cache volta depois de limpar
-----------------------------------------
CAUSA: Service Worker recria cache imediatamente
SOLU√á√ÉO:
- Desregistrar SW antes de limpar cache
- Aguardar desregistro completo
- Recarregar com par√¢metro nocache
- Atualizar vers√£o do SW

// Ordem correta
1. Desregistrar SW
2. Aguardar 1s
3. Limpar caches
4. Aguardar 1s
5. Recarregar com nocache


PROBLEMA 9: Erro "Failed to execute 'delete' on 'Cache'"
---------------------------------------------------------
CAUSA: Tentando deletar cache que n√£o existe ou j√° foi deletado
SOLU√á√ÉO:
- Verificar se cache existe antes de deletar
- Ignorar erros com .catch()
- Usar Promise.allSettled() ao inv√©s de Promise.all()

Promise.allSettled(
    names.map(name => caches.delete(name))
).then(results => {
    console.log('Resultados:', results);
});


PROBLEMA 10: Performance lenta ao limpar cache
-----------------------------------------------
CAUSA: Muitos caches acumulados ou arquivos grandes
SOLU√á√ÉO:
- Mostrar loading durante opera√ß√£o
- Usar setTimeout para n√£o bloquear UI
- Limpar caches em lotes
- Implementar limpeza peri√≥dica autom√°tica

// Limpar em lotes de 5
async function limparCachesEmLotes() {
    const names = await caches.keys();
    const chunks = [];
    
    for (let i = 0; i < names.length; i += 5) {
        chunks.push(names.slice(i, i + 5));
    }
    
    for (const chunk of chunks) {
        await Promise.all(chunk.map(name => caches.delete(name)));
        await sleep(100); // Pausa entre lotes
    }
}

================================================================================
10. BOAS PR√ÅTICAS
================================================================================

‚úÖ FAZER (Best Practices):
--------------------------

1. SEMPRE pedir confirma√ß√£o antes de limpar cache
   ‚úì Usar confirm() ou modal customizado
   ‚úì Explicar claramente o que ser√° deletado
   ‚úì Destacar o que ser√° preservado

2. SEMPRE mostrar feedback visual
   ‚úì Modal/toast durante opera√ß√£o
   ‚úì Loading spinner ou progress bar
   ‚úì Mensagem de sucesso antes de recarregar

3. SEMPRE preservar dados importantes
   ‚úì N√ÉO deletar IndexedDB (formul√°rios)
   ‚úì N√ÉO deletar localStorage (configura√ß√µes)
   ‚úì Apenas limpar caches e sessionStorage

4. SEMPRE adicionar tratamento de erros
   ‚úì try/catch em opera√ß√µes ass√≠ncronas
   ‚úì .catch() em promises
   ‚úì Mostrar mensagem de erro ao usu√°rio

5. SEMPRE logar a√ß√µes no console
   ‚úì console.log() para debug
   ‚úì Listar caches deletados
   ‚úì Registrar sucesso/erro

6. SEMPRE testar em diferentes cen√°rios
   ‚úì Online e offline
   ‚úì Desktop e mobile
   ‚úì Diferentes navegadores
   ‚úì Com e sem Service Worker

7. SEMPRE usar cores intuitivas
   ‚úì Laranja (#ff9800) para atualizar
   ‚úì Vermelho (#f44336) para deletar
   ‚úì Verde (#4caf50) para sucesso

8. SEMPRE adicionar tooltips
   ‚úì Atributo title explicativo
   ‚úì Descrever claramente a fun√ß√£o
   ‚úì Mencionar preserva√ß√£o de dados

9. SEMPRE implementar responsividade
   ‚úì Media queries para mobile
   ‚úì Bot√µes menores em telas pequenas
   ‚úì Esconder texto, manter √≠cone

10. SEMPRE versionar caches
    ‚úì Usar nomes com vers√£o: 'app-v1', 'app-v2'
    ‚úì Deletar vers√µes antigas automaticamente
    ‚úì Facilitar rollback se necess√°rio


‚ùå N√ÉO FAZER (Anti-patterns):
-----------------------------

1. ‚ùå N√ÉO limpar cache sem confirma√ß√£o
   ‚Üí Pode causar perda de dados n√£o salvos
   ‚Üí Frustra usu√°rio com recarga inesperada

2. ‚ùå N√ÉO deletar localStorage sem avisar
   ‚Üí Perde configura√ß√µes do usu√°rio
   ‚Üí Requer reconfigura√ß√£o completa

3. ‚ùå N√ÉO deletar IndexedDB
   ‚Üí Perde formul√°rios n√£o sincronizados
   ‚Üí Perda de dados cr√≠ticos

4. ‚ùå N√ÉO recarregar sem feedback
   ‚Üí Usu√°rio n√£o sabe o que est√° acontecendo
   ‚Üí Parece que sistema travou

5. ‚ùå N√ÉO ignorar erros silenciosamente
   ‚Üí Usu√°rio n√£o sabe que opera√ß√£o falhou
   ‚Üí Dificulta troubleshooting

6. ‚ùå N√ÉO usar apenas reload() simples
   ‚Üí Cache pode persistir
   ‚Üí Usar reload(true) ou adicionar nocache

7. ‚ùå N√ÉO esquecer de desregistrar SW
   ‚Üí SW continua ativo e recria cache
   ‚Üí Limpeza n√£o funciona completamente

8. ‚ùå N√ÉO adicionar bot√µes sem documenta√ß√£o
   ‚Üí Usu√°rios n√£o sabem quando usar
   ‚Üí Podem usar incorretamente

9. ‚ùå N√ÉO usar z-index baixo no feedback
   ‚Üí Modal fica atr√°s de outros elementos
   ‚Üí N√£o √© vis√≠vel para o usu√°rio

10. ‚ùå N√ÉO testar apenas no desktop
    ‚Üí Problemas em mobile n√£o detectados
    ‚Üí UX ruim em tablets


üìã CHECKLIST DE VALIDA√á√ÉO FINAL:
---------------------------------

Antes de considerar implementa√ß√£o completa:

‚ñ° Bot√µes aparecem corretamente no header
‚ñ° Cores apropriadas (laranja/vermelho)
‚ñ° Tooltips explicativos funcionando
‚ñ° Confirma√ß√£o antes de deletar
‚ñ° Feedback visual durante opera√ß√£o
‚ñ° Caches sendo deletados (verificar no DevTools)
‚ñ° Service Worker sendo desregistrado
‚ñ° IndexedDB preservado (formul√°rios intactos)
‚ñ° localStorage preservado (configura√ß√µes intactas)
‚ñ° P√°gina recarrega ap√≥s limpeza
‚ñ° Funciona offline ‚Üí online
‚ñ° Responsivo em mobile
‚ñ° Testado em Chrome, Firefox, Edge
‚ñ° Erros tratados com try/catch
‚ñ° Console.log para debug
‚ñ° C√≥digo documentado

================================================================================
RECURSOS ADICIONAIS
================================================================================

üìö DOCUMENTA√á√ÉO OFICIAL:
------------------------
- Cache API: https://developer.mozilla.org/en-US/docs/Web/API/Cache
- Service Worker: https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API
- IndexedDB: https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API

üõ†Ô∏è FERRAMENTAS:
----------------
- Chrome DevTools ‚Üí Application ‚Üí Cache Storage
- Chrome DevTools ‚Üí Application ‚Üí Service Workers
- Lighthouse ‚Üí PWA Audit

üìñ GUIAS RELACIONADOS:
----------------------
- PWA Best Practices: https://web.dev/pwa/
- Service Worker Lifecycle: https://web.dev/service-worker-lifecycle/
- Cache Strategies: https://jakearchibald.com/2014/offline-cookbook/

================================================================================
BOA SORTE NA IMPLEMENTA√á√ÉO! üöÄ
================================================================================

Este guia cobre 100% da implementa√ß√£o dos bot√µes de cache e atualiza√ß√£o.
Use-o como refer√™ncia durante o desenvolvimento do novo sistema.

Arquivo de refer√™ncia: c:\Users\darkf\OneDrive\Documentos\ematech\DEPLOY_RAILWAY\
- index.html (linhas 48-52)
- script.js (linhas 157-290)
- styles.css (linhas 480-540)
