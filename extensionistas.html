<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Questionário Extensionistas Emater-RO</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📝</text></svg>">

    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #558b2f;
            --accent-color: #7cb342;
            --text-dark: #1b5e20;
            --text-light: #ffffff;
            --bg-light: #f1f8e9;
            --bg-white: #ffffff;
            --border-color: #c5e1a5;
            --error-color: #d32f2f;
            --warning-color: #f57c00;
            --success-color: #388e3c;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --transition-fast: 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Layout geral */

        .app-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem 3rem;
        }

        .app-header {
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 50%, #4caf50 100%);
            padding: 2.5rem 2rem 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(46, 125, 50, 0.3), 0 2px 8px rgba(0, 0, 0, 0.1);
            color: white;
        }

        .app-header h1 {
            margin: 0 0 0.5rem;
            font-size: 2rem;
            color: white;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .app-header .subtitle {
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        /* Container de Ações do Cabeçalho */
        .header-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Botões de Cache */
        .cache-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .cache-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .cache-btn:active {
            transform: translateY(-1px);
        }

        /* Variante Laranja - Atualizar */
        .cache-btn-warning {
            background: linear-gradient(135deg, #ff9800, #fb8c00);
            color: white;
        }

        .cache-btn-warning:hover {
            background: linear-gradient(135deg, #fb8c00, #f57c00);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Variante Vermelha - Limpar */
        .cache-btn-danger {
            background: linear-gradient(135deg, #f44336, #e53935);
            color: white;
        }

        .cache-btn-danger:hover {
            background: linear-gradient(135deg, #e53935, #d32f2f);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Animação Pulse para botão de atualização */
        @keyframes pulse-update {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
            }
            50% {
                box-shadow: 0 4px 20px rgba(255, 152, 0, 0.6);
            }
        }

        .cache-btn-warning {
            animation: pulse-update 3s infinite;
        }

        /* Menu Administrativo */
        .admin-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .admin-toggle {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .admin-toggle:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.6);
        }

        .admin-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            min-width: 220px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .admin-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .admin-dropdown-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-dropdown a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
        }

        .admin-dropdown a:last-child {
            border-bottom: none;
        }

        .admin-dropdown a:hover {
            background: var(--bg-light);
            padding-left: 20px;
        }

        .admin-dropdown .icon {
            font-size: 1.2rem;
        }

        .subtitle {
            margin: 0;
            color: #666;
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Barra de progresso */

        .progress-container {
            margin-top: 1.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 0.5rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffffff, rgba(255, 255, 255, 0.9));
            transition: width 0.4s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        #progressText {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Formulário */

        form {
            background: var(--bg-white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 2.5rem;
        }

        /* Seções */

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .section-header h3 {
            margin: 0 0 0.5rem;
            font-size: 1.6rem;
            font-weight: 700;
        }

        .section-header .text-muted {
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        /* Grupos de campos */

        .question-group {
            margin-bottom: 2rem;
        }

        .question-label {
            display: block;
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
        }

        .question-label.required::after {
            content: " *";
            color: var(--error-color);
        }

        .question-description {
            font-size: 0.95em;
            color: #666;
            margin-top: 0.25rem;
            font-style: italic;
        }

        .hint {
            font-weight: normal;
            font-size: 0.85rem;
            color: #666;
        }

        /* Inputs */

        .input-field,
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: all var(--transition-fast);
        }

        .input-field:focus,
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        fieldset.question-group {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        fieldset.question-group legend {
            font-weight: 600;
            padding: 0 0.5rem;
            font-size: 1.1em;
            color: var(--text-dark);
        }

        /* Radio buttons */

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .radio-label:hover {
            background: var(--bg-light);
            border-color: var(--accent-color);
            transform: translateX(5px);
        }

        .radio-label input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .radio-label span {
            flex: 1;
            font-size: 1em;
        }

        /* Checkboxes */

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .checkbox-label:hover {
            background: var(--bg-light);
            border-color: var(--accent-color);
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .checkbox-label span {
            flex: 1;
            font-size: 1em;
        }

        .text-muted {
            color: #666;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }

        /* Sistema Likert */

        .likert-scale {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 15px;
        }

        .likert-label {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
        }

        .likert-label:hover {
            background: var(--bg-light);
            border-color: var(--accent-color);
            transform: translateY(-3px);
        }

        .likert-label input[type="radio"] {
            display: none;
        }

        .likert-number {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .likert-text {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }

        .likert-label:has(input:checked) {
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .likert-label:has(input:checked) .likert-number,
        .likert-label:has(input:checked) .likert-text {
            color: white;
        }

        /* Navegação */

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 15px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all var(--transition-fast);
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 10px rgba(46, 125, 50, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }

        .btn-secondary {
            background: #9e9e9e;
            color: white;
        }

        .btn-secondary:hover {
            background: #757575;
            transform: translateY(-2px);
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .hidden {
            display: none !important;
        }

        /* Debug */

        .debug-output {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #0b1120;
            color: #e5e7eb;
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            overflow-x: auto;
        }

        /* Animação */

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                max-height: 500px;
                transform: translateY(0);
            }
        }

        .conditional-field {
            animation: slideDown 0.3s ease;
            overflow: hidden;
        }

        /* Responsivo */

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem 0.75rem 2rem;
            }

            form {
                padding: 1.5rem;
            }

            .section-header h3 {
                font-size: 1.3rem;
            }

            .navigation-buttons {
                flex-direction: column-reverse;
            }

            .btn {
                width: 100%;
            }

            .likert-scale {
                flex-wrap: wrap;
            }

            .likert-label {
                min-width: calc(20% - 8px);
                padding: 12px 5px;
            }

            .likert-number {
                font-size: 1.5em;
            }

            .likert-text {
                font-size: 0.75em;
            }

            .app-header {
                padding: 1.5rem 1rem;
            }

            .app-header h1 {
                font-size: 1.5rem;
            }

            .header-actions {
                gap: 8px;
            }

            .cache-btn {
                padding: 8px 14px;
                font-size: 0.85rem;
                gap: 6px;
            }
        }
        
        /* ========================================
           MODAL DE LOADING E NOTIFICAÇÕES
           ======================================== */
        
        .sync-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .sync-modal-overlay.active {
            display: flex;
        }
        
        .sync-modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: slideUp 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .sync-spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px;
            border: 6px solid #f3f4f6;
            border-top: 6px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sync-modal h3 {
            font-size: 1.5em;
            color: var(--text-color);
            margin-bottom: 12px;
        }
        
        .sync-modal p {
            color: #6b7280;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .sync-progress {
            background: #f3f4f6;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .sync-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .sync-status {
            font-size: 0.9em;
            color: #9ca3af;
            margin-top: 10px;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            min-width: 300px;
            max-width: 400px;
            padding: 16px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideInRight 0.4s ease;
            border-left: 4px solid;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .toast.success {
            border-left-color: #10b981;
        }
        
        .toast.error {
            border-left-color: #ef4444;
        }
        
        .toast.info {
            border-left-color: #3b82f6;
        }
        
        .toast.warning {
            border-left-color: #f59e0b;
        }
        
        .toast-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
            font-size: 0.95em;
        }
        
        .toast-message {
            color: #6b7280;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .toast-close:hover {
            background: #f3f4f6;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Modal de Sincronização -->
    <div class="sync-modal-overlay" id="syncModal">
        <div class="sync-modal">
            <div class="sync-spinner"></div>
            <h3 id="syncModalTitle">Salvando Formulário</h3>
            <p id="syncModalMessage">Aguarde enquanto processamos suas informações...</p>
            <div class="sync-progress">
                <div class="sync-progress-bar" id="syncProgressBar"></div>
            </div>
            <div class="sync-status" id="syncStatus">Preparando dados...</div>
        </div>
    </div>
    
    <!-- Menu Administrativo -->
    <div class="admin-menu">
        <button class="admin-toggle" onclick="toggleAdminMenu()" title="Menu Administrativo">⚙️</button>
        <div class="admin-dropdown" id="adminDropdown">
            <div class="admin-dropdown-header">Menu</div>
            <a href="menu.html">
                <span class="icon">🏠</span>
                <span>Voltar ao Menu Principal</span>
            </a>
            <a href="admin.html">
                <span class="icon">📊</span>
                <span>Painel Administrativo</span>
            </a>
            <a href="relatorios.html">
                <span class="icon">📈</span>
                <span>Relatórios e Análises</span>
            </a>
            <a href="mapa-cobertura.html">
                <span class="icon">🗺️</span>
                <span>Mapa de Cobertura</span>
            </a>
        </div>
    </div>

    <div class="app-container">
        <header class="app-header">
            <h1>Questionário – Extensionistas Emater-RO</h1>
            <p class="subtitle">
                Preencha o formulário a seguir. Seus dados serão utilizados apenas para fins de pesquisa e aperfeiçoamento da atuação da Emater-RO.
            </p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressFill"></div>
                </div>
                <span id="progressText">Etapa 1 de 6</span>
            </div>

            <!-- Botões de Gestão de Cache -->
            <div class="header-actions">
                <button type="button" 
                        class="cache-btn cache-btn-warning" 
                        onclick="forceHardRefresh()" 
                        title="Forçar atualização completa do sistema (limpa cache e recarrega)">
                    🔄 Atualizar Sistema
                </button>
                <button type="button" 
                        class="cache-btn cache-btn-danger" 
                        onclick="limparCacheCompleto()" 
                        title="Limpeza emergencial completa (preserva formulários salvos)">
                    🗑️ Limpar Cache
                </button>
            </div>
        </header>

        <main>
            <form id="questionarioEmater">
                <!-- ETAPA 1: IDENTIFICAÇÃO -->
                <section class="form-section active" id="section-1" data-step="1">
                    <div class="section-header">
                        <h3>Módulo I – Identificação</h3>
                        <p class="text-muted">Tempo estimado: 3 minutos</p>
                    </div>

                    <div class="question-group">
                        <label for="municipio" class="question-label">Município onde atua:</label>
                        <select id="municipio" name="municipio" class="input-field">
                            <option value="">Selecione...</option>
                            <option value="Alta Floresta D'Oeste">Alta Floresta d'Oeste</option>
                            <option value="Alto Alegre dos Parecis">Alto Alegre dos Parecis</option>
                            <option value="Alto Paraíso">Alto Paraíso</option>
                            <option value="Alvorada D'Oeste">Alvorada d'Oeste</option>
                            <option value="Ariquemes">Ariquemes</option>
                            <option value="Buritis">Buritis</option>
                            <option value="Cabixi">Cabixi</option>
                            <option value="Cacaulândia">Cacaulândia</option>
                            <option value="Cacoal">Cacoal</option>
                            <option value="Campo Novo de Rondônia">Campo Novo de Rondônia</option>
                            <option value="Candeias do Jamari">Candeias do Jamari</option>
                            <option value="Castanheiras">Castanheiras</option>
                            <option value="Cerejeiras">Cerejeiras</option>
                            <option value="Chupinguaia">Chupinguaia</option>
                            <option value="Colorado do Oeste">Colorado do Oeste</option>
                            <option value="Corumbiara">Corumbiara</option>
                            <option value="Costa Marques">Costa Marques</option>
                            <option value="Cujubim">Cujubim</option>
                            <option value="Espigão D'Oeste">Espigão d'Oeste</option>
                            <option value="Governador Jorge Teixeira">Governador Jorge Teixeira</option>
                            <option value="Guajará-Mirim">Guajará-Mirim</option>
                            <option value="Itapuã do Oeste">Itapuã do Oeste</option>
                            <option value="Jaru">Jaru</option>
                            <option value="Ji-Paraná">Ji-Paraná</option>
                            <option value="Machadinho D'Oeste">Machadinho d'Oeste</option>
                            <option value="Ministro Andreazza">Ministro Andreazza</option>
                            <option value="Mirante da Serra">Mirante da Serra</option>
                            <option value="Monte Negro">Monte Negro</option>
                            <option value="Nova Brasilândia D'Oeste">Nova Brasilândia d'Oeste</option>
                            <option value="Nova Mamoré">Nova Mamoré</option>
                            <option value="Nova União">Nova União</option>
                            <option value="Novo Horizonte do Oeste">Novo Horizonte do Oeste</option>
                            <option value="Ouro Preto do Oeste">Ouro Preto do Oeste</option>
                            <option value="Parecis">Parecis</option>
                            <option value="Pimenta Bueno">Pimenta Bueno</option>
                            <option value="Pimenteiras do Oeste">Pimenteiras do Oeste</option>
                            <option value="Porto Velho">Porto Velho</option>
                            <option value="Presidente Médici">Presidente Médici</option>
                            <option value="Primavera de Rondônia">Primavera de Rondônia</option>
                            <option value="Rio Crespo">Rio Crespo</option>
                            <option value="Rolim de Moura">Rolim de Moura</option>
                            <option value="Santa Luzia D'Oeste">Santa Luzia d'Oeste</option>
                            <option value="São Felipe D'Oeste">São Felipe d'Oeste</option>
                            <option value="São Francisco do Guaporé">São Francisco do Guaporé</option>
                            <option value="São Miguel do Guaporé">São Miguel do Guaporé</option>
                            <option value="Seringueiras">Seringueiras</option>
                            <option value="Teixeirópolis">Teixeirópolis</option>
                            <option value="Theobroma">Theobroma</option>
                            <option value="Urupá">Urupá</option>
                            <option value="Vale do Anari">Vale do Anari</option>
                            <option value="Vale do Paraíso">Vale do Paraíso</option>
                            <option value="Vilhena">Vilhena</option>
                        </select>
                        <small class="text-muted">52 municípios de Rondônia</small>
                    </div>

                    <div class="question-group">
                        <label for="escritorioLocal" class="question-label">Unidade/Escritório Local:</label>
                        <select id="escritorioLocal" name="escritorioLocal" class="input-field" disabled>
                            <option value="">Selecione primeiro um município</option>
                        </select>
                        <small class="text-muted">As unidades serão carregadas após selecionar o município</small>
                    </div>

                    <fieldset class="question-group">
                        <legend>Tempo de atuação na Emater-RO:</legend>
                        <div class="radio-group">
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="menos5"> <span>menos de 5 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="5a9"> <span>5–9 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="10a14"> <span>10–14 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="15a19"> <span>15–19 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="20a24"> <span>20–24 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="25a29"> <span>25–29 anos</span></label>
                            <label class="radio-label"><input type="radio" name="tempoEmater" value="mais30"> <span>mais de 30 anos</span></label>
                        </div>
                    </fieldset>

                    <div class="question-group">
                        <label for="nomeCompleto" class="question-label">
                            Nome completo (opcional):
                        </label>
                        <p class="question-description">Preencher apenas se desejar se identificar.</p>
                        <input type="text" id="nomeCompleto" name="nomeCompleto" class="input-field" placeholder="(opcional)">
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()" disabled>Voltar</button>
                        <button type="button" class="btn btn-primary" onclick="nextSection()">Próximo</button>
                    </div>
                </section>

                <!-- ETAPA 2: EIXO A -->
                <section class="form-section" id="section-2" data-step="2">
                    <div class="section-header">
                        <h3>Eixo A – Métodos de ATER e Resultados Percebidos</h3>
                        <p class="text-muted">Tempo estimado: 5 minutos</p>
                    </div>

                    <!-- QUESTÃO 1: Métodos utilizados com maior frequência -->
                    <fieldset class="question-group">
                        <legend>1) Quais métodos você utiliza com maior frequência? <span class="hint">(marque até 3)</span></legend>
                        <div class="checkbox-group" data-max-check="3">
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="visitas_tecnicas"> <span>Visitas técnicas individuais</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="dias_campo"> <span>Dias de campo</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="demonstracao_metodo"> <span>Demonstração de Método</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="capacitacoes_coletivas"> <span>Capacitações coletivas</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="whatsapp_digital"> <span>Grupos de WhatsApp/comunicação digital</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="planejamento_produtivo"> <span>Planejamento produtivo</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosFrequentes" value="apoio_programas"> <span>Apoio para acessar programas (DAP/CAF/Pronaf etc.)</span></label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="metodosFrequentes" value="outro">
                                <span>Outro: <input type="text" name="metodosFrequentesOutro" class="input-field" placeholder="Descreva" style="margin-top: 8px;" /></span>
                            </label>
                        </div>
                        <p class="text-muted">Máximo de 3 opções</p>
                    </fieldset>

                    <!-- QUESTÃO 2: Métodos que geram melhores resultados -->
                    <fieldset class="question-group">
                        <legend>2) Quais métodos geram melhores resultados? <span class="hint">(marque até 3)</span></legend>
                        <div class="checkbox-group" data-max-check="3">
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="visitas_tecnicas"> <span>Visitas técnicas individuais</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="dias_campo"> <span>Dias de campo</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="demonstracao_metodo"> <span>Demonstração de Método</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="capacitacoes_coletivas"> <span>Capacitações coletivas</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="whatsapp_digital"> <span>Grupos de WhatsApp/comunicação digital</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="planejamento_produtivo"> <span>Planejamento produtivo</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="metodosMelhoresResultados" value="apoio_programas"> <span>Apoio para acessar programas (DAP/CAF/Pronaf etc.)</span></label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="metodosMelhoresResultados" value="outro">
                                <span>Outro: <input type="text" name="metodosMelhoresResultadosOutro" class="input-field" placeholder="Descreva" style="margin-top: 8px;" /></span>
                            </label>
                        </div>
                        <p class="text-muted">Máximo de 3 opções</p>
                    </fieldset>

                    <!-- QUESTÃO 3: Principais dificuldades -->
                    <div class="question-group">
                        <label class="question-label">
                            3) Quais as principais dificuldades enfrentadas no campo para alcançar resultados efetivos?
                        </label>
                        <p class="question-description">1 = nada relevante, 5 = muito relevante</p>

                        <!-- Falta de tempo do extensionista -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">a) Falta de tempo do extensionista</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_falta_tempo" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_falta_tempo" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_falta_tempo" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_falta_tempo" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_falta_tempo" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Número insuficiente de técnicos -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">b) Número insuficiente de técnicos</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_num_tecnicos" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_num_tecnicos" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_num_tecnicos" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_num_tecnicos" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_num_tecnicos" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Distância/locomoção -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">c) Distância/locomoção</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_distancia" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_distancia" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_distancia" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_distancia" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_distancia" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Baixa adesão dos produtores -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">d) Baixa adesão dos produtores</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_baixa_adesao" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_baixa_adesao" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_baixa_adesao" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_baixa_adesao" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_baixa_adesao" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Limitações de recursos/insumos -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">e) Limitações de recursos/insumos</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_recursos" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_recursos" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_recursos" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_recursos" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_recursos" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Demandas administrativas internas -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">f) Demandas administrativas internas</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_demandas_admin" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_demandas_admin" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_demandas_admin" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_demandas_admin" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_demandas_admin" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>

                        <!-- Estrutura de metas e atividades definidas -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="font-weight: 500; margin-bottom: 0.5rem;">g) Estrutura de metas e atividades definidas</p>
                            <div class="likert-scale">
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_metas" value="1">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">Nada relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_metas" value="2">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">Pouco relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_metas" value="3">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">Relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_metas" value="4">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">Muito relevante</span>
                                </label>
                                <label class="likert-label">
                                    <input type="radio" name="dificuldade_metas" value="5">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">Extremamente relevante</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Campo de comentário aberto -->
                    <div class="question-group">
                        <label for="comentario_eixo_a" class="question-label">
                            Gostaria de registrar algum comentário ou descrições sobre sua experiência relacionado a esse bloco?
                        </label>
                        <textarea 
                            id="comentario_eixo_a" 
                            name="comentario_eixo_a" 
                            class="input-field" 
                            rows="4" 
                            placeholder="Digite aqui seus comentários (opcional)"
                            style="width: 100%; resize: vertical; font-family: inherit; padding: 0.75rem;"></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()">Voltar</button>
                        <button type="button" class="btn btn-primary" onclick="nextSection()">Próximo</button>
                    </div>
                </section>

                <!-- ETAPA 3: EIXO B -->
                <section class="form-section" id="section-3" data-step="3">
                    <div class="section-header">
                        <h3>Eixo B – Critérios de Priorização e Equidade</h3>
                        <p class="text-muted">Tempo estimado: 4 minutos</p>
                    </div>

                    <!-- QUESTÃO 4: Como os atendimentos são priorizados -->
                    <fieldset class="question-group">
                        <legend>4) Como os atendimentos são priorizados no seu escritório?</legend>
                        <div class="checkbox-group">
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="demanda_espontanea"> <span>Por demanda espontânea</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="criterios_tecnicos_emater"> <span>Por critérios técnicos definidos pela Emater</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="criterios_tecnicos_extensionista"> <span>Por critérios técnicos definidos pelo extensionista</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="politicas_publicas"> <span>Por políticas públicas específicas (PAA/PNAE etc.)</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="vulnerabilidade_social"> <span>Por vulnerabilidade social (mulheres, jovens, comunidades afastadas)</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="priorizacao_atendimentos" value="ordem_chegada"> <span>Por ordem de chegada</span></label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="priorizacao_atendimentos" value="outro">
                                <span>Outro: <input type="text" name="priorizacao_atendimentos_outro" class="input-field" placeholder="Descreva" style="margin-top: 8px;" /></span>
                            </label>
                        </div>
                    </fieldset>

                    <!-- QUESTÃO 5: Nível de equidade -->
                    <div class="question-group">
                        <label class="question-label">
                            5) Avalie o nível de equidade no atendimento da sua unidade:
                        </label>
                        <p class="question-description">1 = muito baixa, 5 = muito alta</p>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="nivel_equidade" value="1">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Muito baixa</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="nivel_equidade" value="2">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Baixa</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="nivel_equidade" value="3">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Média</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="nivel_equidade" value="4">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Alta</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="nivel_equidade" value="5">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Muito alta</span>
                            </label>
                        </div>
                    </div>

                    <!-- QUESTÃO 6: Instrumentos formais -->
                    <fieldset class="question-group">
                        <legend>6) Existem instrumentos formais de priorização?</legend>
                        <div class="radio-group">
                            <label class="radio-label"><input type="radio" name="instrumentos_formais" value="sim_oficiais"> <span>Sim, utilizamos instrumentos oficiais</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentos_formais" value="sim_parcialmente"> <span>Sim, mas usamos apenas parcialmente</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentos_formais" value="nao_existe"> <span>Não existe instrumento</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentos_formais" value="nao_sei"> <span>Não sei</span></label>
                        </div>
                    </fieldset>

                    <div class="question-group">
                        <label for="exemplo_instrumento_formal" class="question-label">
                            Caso Sim, dê um exemplo:
                        </label>
                        <textarea 
                            id="exemplo_instrumento_formal" 
                            name="exemplo_instrumento_formal" 
                            class="input-field" 
                            rows="3" 
                            placeholder="Descreva o instrumento utilizado (opcional)"></textarea>
                    </div>

                    <div class="question-group">
                        <label for="comentario_eixo_b" class="question-label">
                            Gostaria de registrar algum comentário ou descrições sobre sua experiência relacionado a esse bloco?
                        </label>
                        <textarea 
                            id="comentario_eixo_b" 
                            name="comentario_eixo_b" 
                            class="input-field" 
                            rows="4" 
                            placeholder="Digite aqui seus comentários (opcional)"
                            style="width: 100%; resize: vertical; font-family: inherit; padding: 0.75rem;"></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()">Voltar</button>
                        <button type="button" class="btn btn-primary" onclick="nextSection()">Próximo</button>
                    </div>
                </section>
                <!-- ETAPA 4: EIXO C -->
                <section class="form-section" id="section-4" data-step="4">
                    <div class="section-header">
                        <h3>Eixo C – Parcerias e Atuação em Fóruns</h3>
                        <p class="text-muted">Tempo estimado: 5 minutos</p>
                    </div>

                    <fieldset class="question-group">
                        <legend>Quais parcerias são mais ativas? <span class="hint">(marcar até 3)</span></legend>
                        <div class="checkbox-group" data-max-check="3">
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="idaron"> <span>Idaron</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="embrapa"> <span>Embrapa</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="prefeituras"> <span>Prefeituras</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="sedam"> <span>Sedam</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="secretarias_municipais"> <span>Secretarias municipais</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="cooperativas_associacoes"> <span>Cooperativas/associações</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="movimentos_sociais"> <span>Movimentos sociais</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="instituicoes_financeiras"> <span>Instituições financeiras</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="sistema_s"> <span>Sistema S (Senar, Sebrae etc.)</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="parceriasAtivas" value="sindicatos"> <span>Sindicatos</span></label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="parceriasAtivas" value="outro">
                                <span>Outro: <input type="text" name="parceriasAtivasOutro" class="input-field" placeholder="Descreva" style="margin-top: 8px;" /></span>
                            </label>
                        </div>
                        <p class="text-muted">Máximo de 3 opções</p>
                    </fieldset>

                    <fieldset class="question-group">
                        <legend>Você participa de fóruns, comissões ou conselhos locais?</legend>
                        <div class="radio-group">
                            <label class="radio-label"><input type="radio" name="participaForuns" value="sim_frequentemente"> <span>Sim, frequentemente</span></label>
                            <label class="radio-label"><input type="radio" name="participaForuns" value="sim_ocasionamente"> <span>Sim, ocasionalmente</span></label>
                            <label class="radio-label"><input type="radio" name="participaForuns" value="nao_participa"> <span>Não participa</span></label>
                        </div>
                    </fieldset>

                    <div class="question-group">
                        <label class="question-label">
                            Avalie o grau de influência da Emater nesses espaços.
                        </label>
                        <p class="question-description">(1 = nenhuma, 5 = muito alta)</p>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="influenciaEmater" value="1">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Nenhuma</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="influenciaEmater" value="2">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Baixa</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="influenciaEmater" value="3">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Média</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="influenciaEmater" value="4">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Alta</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="influenciaEmater" value="5">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Muito alta</span>
                            </label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label for="comentarioC" class="question-label">
                            Gostaria de registrar algum comentário ou descrição sobre sua experiência relacionada a esse bloco?
                        </label>
                        <textarea id="comentarioC" name="comentarioC" class="input-field" rows="4" placeholder="Escreva aqui (opcional)"></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()">Voltar</button>
                        <button type="button" class="btn btn-primary" onclick="nextSection()">Próximo</button>
                    </div>
                </section>

                <!-- ETAPA 5: EIXO D -->
                <section class="form-section" id="section-5" data-step="5">
                    <div class="section-header">
                        <h3>Eixo D – Articulação Produtiva e Comercialização</h3>
                        <p class="text-muted">Tempo estimado: 7 minutos</p>
                    </div>

                    <div class="question-group">
                        <label for="freqDemandaMercado" class="question-label">
                            Com que frequência você orienta os agricultores com base na demanda de mercado?
                        </label>
                        <select id="freqDemandaMercado" name="freqDemandaMercado" class="input-field">
                            <option value="">Selecione...</option>
                            <option value="nunca">Nunca</option>
                            <option value="raramente">Raramente</option>
                            <option value="as_vezes">Às vezes</option>
                            <option value="frequentemente">Frequentemente</option>
                            <option value="sempre">Sempre</option>
                        </select>
                    </div>

                    <fieldset class="question-group">
                        <legend>
                            Participou de capacitações sobre mercado, cadeias de valor ou canais de comercialização nos últimos 2 anos?
                        </legend>
                        <div class="radio-group">
                            <label class="radio-label"><input type="radio" name="capacitacaoMercado" value="sim"> <span>Sim</span></label>
                            <label class="radio-label"><input type="radio" name="capacitacaoMercado" value="nao"> <span>Não</span></label>
                        </div>
                    </fieldset>

                    <div class="question-group">
                        <label class="question-label">
                            Avalie o quanto capacitações de mercado ajudam ou ajudariam sua orientação técnica.
                        </label>
                        <p class="question-description">(1 = nada, 5 = muito)</p>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="impactoCapacitacao" value="1">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Nada</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="impactoCapacitacao" value="2">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Pouco</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="impactoCapacitacao" value="3">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Regular</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="impactoCapacitacao" value="4">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Muito</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="impactoCapacitacao" value="5">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Extremamente</span>
                            </label>
                        </div>
                    </div>

                    <fieldset class="question-group">
                        <legend>Existem instrumentos/rotinas para orientar organização da produção?</legend>
                        <div class="radio-group">
                            <label class="radio-label"><input type="radio" name="instrumentosProducao" value="sim_frequentemente"> <span>Sim, usamos frequentemente</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentosProducao" value="sim_pouco"> <span>Sim, mas pouco utilizados</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentosProducao" value="nao_existem"> <span>Não existem</span></label>
                            <label class="radio-label"><input type="radio" name="instrumentosProducao" value="nao_sei"> <span>Não sei</span></label>
                        </div>
                    </fieldset>

                    <div class="question-group">
                        <label for="exemploInstrumentosProducao">
                            Caso “Sim”, dê um exemplo:
                        </label>
                        <textarea id="exemploInstrumentosProducao" name="exemploInstrumentosProducao" class="input-field" rows="3" placeholder="Descreva, se houver (opcional)"></textarea>
                    </div>

                    <div class="question-group">
                        <label for="freqApoioMercadosInstitucionais" class="question-label">
                            Com que frequência você apoia agricultores no acesso a mercados institucionais (como PAA/PNAE)?
                        </label>
                        <select id="freqApoioMercadosInstitucionais" name="freqApoioMercadosInstitucionais">
                            <option value="">Selecione...</option>
                            <option value="nunca">Nunca</option>
                            <option value="raramente">Raramente</option>
                            <option value="as_vezes">Às vezes</option>
                            <option value="frequentemente">Frequentemente</option>
                            <option value="sempre">Sempre</option>
                        </select>
                    </div>

                    <div class="question-group">
                        <label class="question-label">
                            Seu conhecimento sobre oferta/demanda local é…
                        </label>
                        <p class="question-description">(1 = muito baixo, 5 = muito alto)</p>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="conhecimentoOfertaDemanda" value="1">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Muito baixo</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="conhecimentoOfertaDemanda" value="2">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Baixo</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="conhecimentoOfertaDemanda" value="3">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Médio</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="conhecimentoOfertaDemanda" value="4">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Alto</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="conhecimentoOfertaDemanda" value="5">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Muito alto</span>
                            </label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label for="comentarioD" class="question-label">
                            Gostaria de registrar algum comentário ou descrição sobre sua experiência relacionada a esse bloco?
                        </label>
                        <textarea id="comentarioD" name="comentarioD" class="input-field" rows="4" placeholder="Escreva aqui (opcional)"></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()">Voltar</button>
                        <button type="button" class="btn btn-primary" onclick="nextSection()">Próximo</button>
                    </div>
                </section>

                <!-- ETAPA 6: EIXO E + FINAL -->
                <section class="form-section" id="section-6" data-step="6">
                    <div class="section-header">
                        <h3>Eixo E – Indicadores, Relatórios e Avaliação de Resultados</h3>
                        <p class="text-muted">Tempo estimado: 3 minutos</p>
                    </div>

                    <!-- QUESTÃO 16: Instrumentos para acompanhar resultados -->
                    <fieldset class="question-group">
                        <legend>16) Quais instrumentos você usa para acompanhar resultados?</legend>
                        <div class="checkbox-group">
                            <label class="checkbox-label"><input type="checkbox" name="instrumentos_acompanhamento" value="sigater"> <span>Registros no Sigater</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="instrumentos_acompanhamento" value="relatorios_internos"> <span>Relatórios internos</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="instrumentos_acompanhamento" value="planilhas_proprias"> <span>Planilhas próprias</span></label>
                            <label class="checkbox-label"><input type="checkbox" name="instrumentos_acompanhamento" value="nenhum"> <span>Nenhum instrumento</span></label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="instrumentos_acompanhamento" value="outro">
                                <span>Outro: <input type="text" name="instrumentos_acompanhamento_outro" class="input-field" placeholder="Descreva" style="margin-top: 8px;" /></span>
                            </label>
                        </div>
                    </fieldset>

                    <!-- QUESTÃO 17: Frequência de uso de indicadores -->
                    <div class="question-group">
                        <label class="question-label">
                            17) Com que frequência você usa indicadores ou relatórios para tomada de decisão?
                        </label>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="freq_uso_indicadores" value="nunca">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Nunca</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="freq_uso_indicadores" value="raramente">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Raramente</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="freq_uso_indicadores" value="as_vezes">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Às vezes</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="freq_uso_indicadores" value="frequentemente">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Frequentemente</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="freq_uso_indicadores" value="sempre">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Sempre</span>
                            </label>
                        </div>
                    </div>

                    <!-- SUBQUESTÃO 17: Principais indicadores utilizados -->
                    <div class="question-group">
                        <label for="principais_indicadores" class="question-label">
                            Cite os principais que você utiliza:
                        </label>
                        <textarea 
                            id="principais_indicadores" 
                            name="principais_indicadores" 
                            class="input-field" 
                            rows="3" 
                            placeholder="Descreva os principais indicadores que você utiliza (opcional)"></textarea>
                    </div>

                    <!-- QUESTÃO 18: Avaliação da ajuda dos indicadores -->
                    <div class="question-group">
                        <label class="question-label">
                            18) Avalie o quanto os indicadores ajudam na tomada de decisão:
                        </label>
                        <p class="question-description">1 = nada, 5 = muito</p>
                        <div class="likert-scale">
                            <label class="likert-label">
                                <input type="radio" name="avaliacao_ajuda_indicadores" value="1">
                                <span class="likert-number">1</span>
                                <span class="likert-text">Nada</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="avaliacao_ajuda_indicadores" value="2">
                                <span class="likert-number">2</span>
                                <span class="likert-text">Pouco</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="avaliacao_ajuda_indicadores" value="3">
                                <span class="likert-number">3</span>
                                <span class="likert-text">Moderado</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="avaliacao_ajuda_indicadores" value="4">
                                <span class="likert-number">4</span>
                                <span class="likert-text">Bastante</span>
                            </label>
                            <label class="likert-label">
                                <input type="radio" name="avaliacao_ajuda_indicadores" value="5">
                                <span class="likert-number">5</span>
                                <span class="likert-text">Muito</span>
                            </label>
                        </div>
                    </div>

                    <!-- Campo aberto de comentários -->
                    <div class="question-group">
                        <label for="comentario_eixo_e" class="question-label">
                            Gostaria de registrar algum comentário ou descrições sobre sua experiência relacionado a esse bloco?
                        </label>
                        <textarea 
                            id="comentario_eixo_e" 
                            name="comentario_eixo_e" 
                            class="input-field" 
                            rows="4" 
                            placeholder="Digite aqui seus comentários (opcional)"
                            style="width: 100%; resize: vertical; font-family: inherit; padding: 0.75rem;"></textarea>
                    </div>

                    <!-- COMENTÁRIO FINAL -->
                    <div class="question-group">
                        <label for="comentario_final" class="question-label">
                            Gostaria de registrar algum comentário adicional sobre sua experiência como extensionista da Emater?
                        </label>
                        <textarea 
                            id="comentario_final" 
                            name="comentario_final" 
                            class="input-field" 
                            rows="4" 
                            placeholder="Comentários gerais sobre sua experiência (opcional)"
                            style="width: 100%; resize: vertical; font-family: inherit; padding: 0.75rem;"></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="previousSection()">Voltar</button>
                        <button type="submit" class="btn btn-primary">Enviar respostas</button>
                    </div>
                </section>
            </form>
            <section id="debugOutput" class="debug-output hidden">
                <h2>Dados coletados (debug)</h2>
                <pre id="debugJson"></pre>
            </section>
        </main>
    </div>

    <!-- IndexedDB Manager -->
    <script src="db-extensionistas.js"></script>
    
    <script>
        // Estado atual do formulário
        let currentSection = 1;  // Começa na seção 1
        const totalSections = 6;
        
        // Inicializar IndexedDB ao carregar página
        initDB().catch(err => console.error('Erro ao inicializar IndexedDB:', err));

        // ===== DADOS: 83 UNIDADES EMATER-RO =====
        const UNIDADES_EMATER = [
            {"nome": "Centro Gerencial", "municipio": "Porto Velho", "tipo": "Centro Gerencial"},
            {"nome": "Esreg de Porto Velho", "municipio": "Porto Velho", "tipo": "ESREG"},
            {"nome": "Porto Velho", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Porto Verde", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Jaci-Paraná", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Vista Alegre do Abunã", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Rio Pardo", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "União Bandeirantes", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Extrema", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Nova Califórnia", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Calama", "municipio": "Porto Velho", "tipo": "ESLOC"},
            {"nome": "Nova Mamoré", "municipio": "Nova Mamoré", "tipo": "ESLOC"},
            {"nome": "Nova Dimensão", "municipio": "Nova Mamoré", "tipo": "ESLOC"},
            {"nome": "Jacinópolis", "municipio": "Nova Mamoré", "tipo": "ESLOC"},
            {"nome": "Guajará-Mirim", "municipio": "Guajará-Mirim", "tipo": "ESLOC"},
            {"nome": "Candeias do Jamari", "municipio": "Candeias do Jamari", "tipo": "ESLOC"},
            {"nome": "Triunfo", "municipio": "Candeias do Jamari", "tipo": "ESLOC"},
            {"nome": "Itapuã do Oeste", "municipio": "Itapuã do Oeste", "tipo": "ESLOC"},
            {"nome": "Esreg de Ariquemes", "municipio": "Ariquemes", "tipo": "ESREG"},
            {"nome": "Ariquemes", "municipio": "Ariquemes", "tipo": "ESLOC"},
            {"nome": "Alto Paraíso", "municipio": "Alto Paraíso", "tipo": "ESLOC"},
            {"nome": "Rio Crespo", "municipio": "Rio Crespo", "tipo": "ESLOC"},
            {"nome": "Cujubim", "municipio": "Cujubim", "tipo": "ESLOC"},
            {"nome": "Machadinho do Oeste", "municipio": "Machadinho D'Oeste", "tipo": "ESLOC"},
            {"nome": "Subunidade 5º BEC", "municipio": "Machadinho D'Oeste", "tipo": "Centro de Treinamento"},
            {"nome": "Cacaulândia", "municipio": "Cacaulândia", "tipo": "ESLOC"},
            {"nome": "Monte Negro", "municipio": "Monte Negro", "tipo": "ESLOC"},
            {"nome": "Buritis", "municipio": "Buritis", "tipo": "ESLOC"},
            {"nome": "Campo Novo de Rondônia", "municipio": "Campo Novo de Rondônia", "tipo": "ESLOC"},
            {"nome": "Esreg de Ji-Paraná", "municipio": "Ji-Paraná", "tipo": "ESREG"},
            {"nome": "Ji-Paraná", "municipio": "Ji-Paraná", "tipo": "ESLOC"},
            {"nome": "Nova Londrina", "municipio": "Ji-Paraná", "tipo": "ESLOC"},
            {"nome": "Nova Colina", "municipio": "Ji-Paraná", "tipo": "ESLOC"},
            {"nome": "Estrela de Rondônia", "municipio": "Ji-Paraná", "tipo": "ESLOC"},
            {"nome": "Presidente Médici", "municipio": "Presidente Médici", "tipo": "ESLOC"},
            {"nome": "Novo Riachuelo", "municipio": "Presidente Médici", "tipo": "ESLOC"},
            {"nome": "Urupá", "municipio": "Urupá", "tipo": "ESLOC"},
            {"nome": "Teixeirópolis", "municipio": "Teixeirópolis", "tipo": "ESLOC"},
            {"nome": "Vale do Paraíso", "municipio": "Vale do Paraíso", "tipo": "ESLOC"},
            {"nome": "Rondominas", "municipio": "Ouro Preto do Oeste", "tipo": "ESLOC"},
            {"nome": "Mirante da Serra", "municipio": "Mirante da Serra", "tipo": "ESLOC"},
            {"nome": "Nova União", "municipio": "Nova União", "tipo": "ESLOC"},
            {"nome": "Tarilândia", "municipio": "Jaru", "tipo": "ESLOC"},
            {"nome": "Governador Jorge Teixeira", "municipio": "Governador Jorge Teixeira", "tipo": "ESLOC"},
            {"nome": "Colina Verde", "municipio": "Governador Jorge Teixeira", "tipo": "ESLOC"},
            {"nome": "Jaru", "municipio": "Jaru", "tipo": "ESLOC"},
            {"nome": "Theobroma", "municipio": "Theobroma", "tipo": "ESLOC"},
            {"nome": "Vale do Anari", "municipio": "Vale do Anari", "tipo": "ESLOC"},
            {"nome": "Ouro Preto do Oeste", "municipio": "Ouro Preto do Oeste", "tipo": "ESLOC"},
            {"nome": "Centrer", "municipio": "Ouro Preto do Oeste", "tipo": "Centro de Treinamento"},
            {"nome": "Esreg de São Francisco do Guaporé", "municipio": "São Francisco do Guaporé", "tipo": "ESREG"},
            {"nome": "São Francisco do Guaporé", "municipio": "São Francisco do Guaporé", "tipo": "ESLOC"},
            {"nome": "São Domingos", "municipio": "Costa Marques", "tipo": "ESLOC"},
            {"nome": "Costa Marques", "municipio": "Costa Marques", "tipo": "ESLOC"},
            {"nome": "Seringueiras", "municipio": "Seringueiras", "tipo": "ESLOC"},
            {"nome": "São Miguel do Guaporé", "municipio": "São Miguel do Guaporé", "tipo": "ESLOC"},
            {"nome": "Alvorada do Oeste", "municipio": "Alvorada D'Oeste", "tipo": "ESLOC"},
            {"nome": "Esreg de Rolim de Moura", "municipio": "Rolim de Moura", "tipo": "ESREG"},
            {"nome": "Rolim de Moura", "municipio": "Rolim de Moura", "tipo": "ESLOC"},
            {"nome": "Novo Horizonte do Oeste", "municipio": "Novo Horizonte do Oeste", "tipo": "ESLOC"},
            {"nome": "Nova Brasilândia do Oeste", "municipio": "Nova Brasilândia D'Oeste", "tipo": "ESLOC"},
            {"nome": "Castanheiras", "municipio": "Castanheiras", "tipo": "ESLOC"},
            {"nome": "Santa Luzia do Oeste", "municipio": "Santa Luzia D'Oeste", "tipo": "ESLOC"},
            {"nome": "Alta Floresta do Oeste", "municipio": "Alta Floresta D'Oeste", "tipo": "ESLOC"},
            {"nome": "Alto Alegre dos Parecis", "municipio": "Alto Alegre dos Parecis", "tipo": "ESLOC"},
            {"nome": "Izidolândia", "municipio": "Alta Floresta D'Oeste", "tipo": "ESLOC"},
            {"nome": "Esreg de Pimenta Bueno", "municipio": "Pimenta Bueno", "tipo": "ESREG"},
            {"nome": "Pimenta Bueno", "municipio": "Pimenta Bueno", "tipo": "ESLOC"},
            {"nome": "Espigão do Oeste", "municipio": "Espigão D'Oeste", "tipo": "ESLOC"},
            {"nome": "Boa Vista do Pacarana", "municipio": "Espigão D'Oeste", "tipo": "ESLOC"},
            {"nome": "Cacoal", "municipio": "Cacoal", "tipo": "ESLOC"},
            {"nome": "Ministro Andreazza", "municipio": "Ministro Andreazza", "tipo": "ESLOC"},
            {"nome": "São Felipe d'Oeste", "municipio": "São Felipe D'Oeste", "tipo": "ESLOC"},
            {"nome": "Primavera de Rondônia", "municipio": "Primavera de Rondônia", "tipo": "ESLOC"},
            {"nome": "Parecis", "municipio": "Parecis", "tipo": "ESLOC"},
            {"nome": "Esreg de Colorado do Oeste", "municipio": "Colorado do Oeste", "tipo": "ESREG"},
            {"nome": "Colorado do Oeste", "municipio": "Colorado do Oeste", "tipo": "ESLOC"},
            {"nome": "Cabixi", "municipio": "Cabixi", "tipo": "ESLOC"},
            {"nome": "Pimenteiras do Oeste", "municipio": "Pimenteiras do Oeste", "tipo": "ESLOC"},
            {"nome": "Cerejeiras", "municipio": "Cerejeiras", "tipo": "ESLOC"},
            {"nome": "Corumbiara", "municipio": "Corumbiara", "tipo": "ESLOC"},
            {"nome": "Chupinguaia", "municipio": "Chupinguaia", "tipo": "ESLOC"},
            {"nome": "Vilhena", "municipio": "Vilhena", "tipo": "ESLOC"}
        ];

        // Função global de navegação para próxima seção
        function nextSection() {
            const currentSectionElement = document.getElementById(`section-${currentSection}`);
            
            // Validar seção atual
            if (!validateSection(currentSectionElement)) {
                alert('Por favor, preencha todos os campos obrigatórios antes de continuar');
                return;
            }
            
            if (currentSection < totalSections) {
                // Remover classe active
                currentSectionElement.classList.remove('active');
                
                // Avançar contador
                currentSection++;
                
                // Ativar próxima seção
                const nextSectionElement = document.getElementById(`section-${currentSection}`);
                nextSectionElement.classList.add('active');
                
                // Atualizar barra de progresso
                updateProgressBar();
                
                // Scroll para topo
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Função global de navegação para seção anterior
        function previousSection() {
            if (currentSection > 1) {
                // Remover classe active
                document.getElementById(`section-${currentSection}`).classList.remove('active');
                
                // Voltar contador
                currentSection--;
                
                // Ativar seção anterior
                document.getElementById(`section-${currentSection}`).classList.add('active');
                
                // Atualizar barra de progresso
                updateProgressBar();
                
                // Scroll para topo
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ==========================================
        // GESTÃO DE CACHE E ATUALIZAÇÃO
        // ==========================================

        /**
         * Força atualização completa do sistema (hard refresh)
         * - Limpa todos os caches
         * - Atualiza Service Worker
         * - Recarrega página sem cache
         */
        async function forceHardRefresh() {
            console.log('🔄 Iniciando hard refresh do sistema...');

            // Feedback visual
            showToast('info', '🔄 Atualizando sistema...', 'Aguarde enquanto limpamos o cache');

            try {
                // Limpar todos os caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    console.log('🗑️ Caches encontrados:', cacheNames);
                    
                    await Promise.all(
                        cacheNames.map(cacheName => {
                            console.log('  - Deletando cache:', cacheName);
                            return caches.delete(cacheName);
                        })
                    );
                    console.log('✅ Todos os caches limpos');
                }

                // Atualizar Service Worker
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        await registration.update();
                        console.log('✅ Service Worker atualizado');
                        
                        // Enviar mensagem para SW pular espera
                        if (navigator.serviceWorker.controller) {
                            navigator.serviceWorker.controller.postMessage({ 
                                type: 'SKIP_WAITING' 
                            });
                        }
                    }
                }

                // Limpar sessionStorage
                sessionStorage.clear();
                console.log('✅ SessionStorage limpo');

            } catch (error) {
                console.error('❌ Erro ao limpar cache:', error);
            } finally {
                // Sempre recarregar (mesmo se houver erro)
                setTimeout(() => {
                    console.log('🔄 Recarregando página...');
                    window.location.reload(true);
                }, 800);
            }
        }

        /**
         * Sistema de notificações toast
         */
        function showToast(type, title, message, duration = 5000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                info: 'ℹ️',
                warning: '⚠️'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || 'ℹ️'}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">×</button>
            `;
            
            container.appendChild(toast);
            
            // Auto-remover após duração
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.4s ease reverse';
                setTimeout(() => toast.remove(), 400);
            }, duration);
        }

        /**
         * Limpeza emergencial completa do cache
         * - Pede confirmação
         * - Remove todos os caches
         * - Desregistra Service Workers
         * - PRESERVA IndexedDB (formulários)
         */
        async function limparCacheCompleto() {
            // Confirmar com usuário
            const confirmacao = confirm(
                '⚠️ ATENÇÃO: Limpeza Emergencial de Cache\n\n' +
                'Esta ação irá:\n' +
                '🗑️ Limpar TODO o cache do sistema\n' +
                '🗑️ Desregistrar Service Worker\n' +
                '🗑️ Remover arquivos temporários\n\n' +
                '✅ PRESERVAR:\n' +
                '📋 Formulários salvos (IndexedDB)\n' +
                '💾 Dados pendentes de sincronização\n\n' +
                'Use apenas se o sistema estiver com problemas graves.\n\n' +
                'Deseja continuar?'
            );

            if (!confirmacao) {
                console.log('❌ Limpeza cancelada pelo usuário');
                return;
            }

            console.log('🗑️ Iniciando limpeza completa de cache...');
            showToast('warning', '🗑️ Limpando cache...', 'Preservando seus formulários');

            try {
                // Limpar sessionStorage
                sessionStorage.clear();
                console.log('✅ SessionStorage limpo');

                // Desregistrar Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                        console.log('✅ Service Worker desregistrado:', registration.scope);
                    }
                }

                // Deletar todos os caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                    console.log('✅ Todos os caches deletados');
                }

                showToast('success', '✅ Cache limpo!', 'Recarregando sistema...');

            } catch (error) {
                console.error('❌ Erro na limpeza:', error);
                showToast('error', '❌ Erro', 'Falha ao limpar cache');
            } finally {
                // Recarregar com parâmetro nocache
                setTimeout(() => {
                    window.location.href = window.location.href.split('?')[0] + '?nocache=' + Date.now();
                }, 1000);
            }
        }

        // ==========================================
        // MENU ADMINISTRATIVO
        // ==========================================

        // Menu Administrativo
        function toggleAdminMenu() {
            const dropdown = document.getElementById('adminDropdown');
            dropdown.classList.toggle('show');
        }

        // Fechar menu ao clicar fora
        document.addEventListener('click', function(event) {
            const adminMenu = document.querySelector('.admin-menu');
            const dropdown = document.getElementById('adminDropdown');
            
            if (adminMenu && !adminMenu.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Validação de seção
        function validateSection(sectionElement) {
            const requiredFields = sectionElement.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (field.type === 'radio') {
                    const name = field.name;
                    const checked = sectionElement.querySelector(`input[name="${name}"]:checked`);
                    if (!checked) {
                        field.focus();
                        return false;
                    }
                } else if (field.type === 'checkbox') {
                    const name = field.name;
                    const checked = sectionElement.querySelectorAll(`input[name="${name}"]:checked`);
                    if (checked.length === 0) {
                        field.focus();
                        return false;
                    }
                } else if (!field.value.trim()) {
                    field.focus();
                    return false;
                }
            }
            
            return true;
        }

        // Atualizar barra de progresso
        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const percent = (currentSection / totalSections) * 100;
            progressFill.style.width = `${percent}%`;
            progressText.textContent = `Etapa ${currentSection} de ${totalSections}`;
        }

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("questionarioEmater");
            const debugSection = document.getElementById("debugOutput");
            const debugJson = document.getElementById("debugJson");

            // ===== FILTRO DINÂMICO: Município -> Unidades EMATER =====
            const selectMunicipio = document.getElementById('municipio');
            const selectEscritorio = document.getElementById('escritorioLocal');

            if (selectMunicipio && selectEscritorio) {
                selectMunicipio.addEventListener('change', function() {
                    const municipioSelecionado = this.value;
                    
                    // Limpar opções anteriores (mantém o placeholder)
                    selectEscritorio.innerHTML = '<option value="">Selecione o escritório local...</option>';
                    
                    if (municipioSelecionado) {
                        // Filtrar unidades do município selecionado
                        const unidadesFiltradas = UNIDADES_EMATER.filter(u => 
                            u.municipio === municipioSelecionado
                        );
                        
                        // Adicionar opções filtradas
                        unidadesFiltradas.forEach(unidade => {
                            const option = document.createElement('option');
                            option.value = unidade.nome;
                            option.textContent = `${unidade.nome} (${unidade.tipo})`;
                            selectEscritorio.appendChild(option);
                        });
                        
                        selectEscritorio.disabled = false;
                    } else {
                        selectEscritorio.disabled = true;
                    }
                });
            }

            // Limitar checkboxes com atributo data-max-check
            document.querySelectorAll("[data-max-check]").forEach((container) => {
                const max = Number(container.getAttribute("data-max-check"));
                const checkboxes = container.querySelectorAll('input[type="checkbox"]');

                checkboxes.forEach((cb) => {
                    cb.addEventListener("change", () => {
                        const checkedCount = Array.from(checkboxes).filter((c) => c.checked).length;
                        if (checkedCount > max) {
                            cb.checked = false;
                            alert(`Você pode marcar no máximo ${max} opções neste grupo.`);
                        }
                    });
                });
            });

            // ========================================
            // CAMPOS CONDICIONAIS (MOSTRAR APENAS SE SIM)
            // ========================================
            
            // Eixo B: Mostrar exemplo_instrumento_formal apenas se instrumentos_formais = sim
            const instrumentosFormaisRadios = document.querySelectorAll('input[name="instrumentos_formais"]');
            const exemploInstrumentoFormalContainer = document.querySelector('#exemplo_instrumento_formal').closest('.question-group');
            
            function toggleExemploInstrumentoFormal() {
                const selectedValue = document.querySelector('input[name="instrumentos_formais"]:checked')?.value;
                if (selectedValue && (selectedValue === 'sim_oficiais' || selectedValue === 'sim_parcialmente')) {
                    exemploInstrumentoFormalContainer.style.display = 'block';
                } else {
                    exemploInstrumentoFormalContainer.style.display = 'none';
                    document.getElementById('exemplo_instrumento_formal').value = ''; // Limpar campo
                }
            }
            
            instrumentosFormaisRadios.forEach(radio => {
                radio.addEventListener('change', toggleExemploInstrumentoFormal);
            });
            toggleExemploInstrumentoFormal(); // Inicializar estado
            
            // Eixo D: Mostrar exemploInstrumentosProducao apenas se instrumentosProducao = sim
            const instrumentosProducaoRadios = document.querySelectorAll('input[name="instrumentosProducao"]');
            const exemploInstrumentosProducaoContainer = document.querySelector('#exemploInstrumentosProducao').closest('.question-group');
            
            function toggleExemploInstrumentosProducao() {
                const selectedValue = document.querySelector('input[name="instrumentosProducao"]:checked')?.value;
                if (selectedValue && (selectedValue === 'sim_frequentemente' || selectedValue === 'sim_pouco')) {
                    exemploInstrumentosProducaoContainer.style.display = 'block';
                } else {
                    exemploInstrumentosProducaoContainer.style.display = 'none';
                    document.getElementById('exemploInstrumentosProducao').value = ''; // Limpar campo
                }
            }
            
            instrumentosProducaoRadios.forEach(radio => {
                radio.addEventListener('change', toggleExemploInstrumentosProducao);
            });
            toggleExemploInstrumentosProducao(); // Inicializar estado

            // ========================================
            // SISTEMA DE NOTIFICAÇÕES E MODAL
            // ========================================
            
            function showSyncModal(title, message, status = '') {
                const modal = document.getElementById('syncModal');
                const modalTitle = document.getElementById('syncModalTitle');
                const modalMessage = document.getElementById('syncModalMessage');
                const modalStatus = document.getElementById('syncStatus');
                const progressBar = document.getElementById('syncProgressBar');
                
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalStatus.textContent = status;
                progressBar.style.width = '30%';
                
                modal.classList.add('active');
            }
            
            function updateSyncModal(status, progress = null) {
                const modalStatus = document.getElementById('syncStatus');
                const progressBar = document.getElementById('syncProgressBar');
                
                modalStatus.textContent = status;
                if (progress !== null) {
                    progressBar.style.width = progress + '%';
                }
            }
            
            function hideSyncModal() {
                const modal = document.getElementById('syncModal');
                modal.classList.remove('active');
            }

            // Submissão do formulário
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                const formData = new FormData(form);
                const data = {};

                // Converter FormData em objeto JS
                for (const [key, value] of formData.entries()) {
                    // Permitir múltiplos valores para a mesma chave (checkbox)
                    if (data[key] !== undefined) {
                        if (!Array.isArray(data[key])) {
                            data[key] = [data[key]];
                        }
                        data[key].push(value);
                    } else {
                        data[key] = value;
                    }
                }

                // Adicionar timestamp de início se não existir
                if (!data.timestamp_inicio) {
                    data.timestamp_inicio = new Date().toISOString();
                }

                // Debug local (mostrar JSON)
                const debugJson = document.getElementById('debugJson');
                const debugSection = document.getElementById('debugOutput');
                debugJson.textContent = JSON.stringify(data, null, 2);
                debugSection.classList.remove("hidden");

                // Desabilitar botão de envio
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = '💾 Salvando...';
                
                // Mostrar modal de loading
                showSyncModal(
                    '💾 Salvando Formulário',
                    'Processando suas respostas e preparando para salvar...',
                    'Iniciando...'
                );

                try {
                    // Salvar localmente
                    updateSyncModal('Salvando dados localmente...', 50);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const resultado = await salvarFormulario(data);
                    
                    if (resultado.success) {
                        updateSyncModal('Dados salvos com sucesso! ✅', 100);
                        await new Promise(resolve => setTimeout(resolve, 800));
                        
                        hideSyncModal();
                        
                        showToast(
                            'success',
                            'Formulário Salvo!',
                            `Protocolo: ${resultado.protocolo}. Seus dados foram salvos localmente com sucesso.`,
                            5000
                        );
                        
                        // Resetar formulário
                        form.reset();
                        currentSection = 1;
                        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
                        document.getElementById('section-1').classList.add('active');
                        updateProgressBar();
                        debugSection.classList.add("hidden");
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        
                        // Informar sobre sincronização (automática ou manual)
                        setTimeout(() => {
                            if (navigator.onLine) {
                                showToast(
                                    'info',
                                    'Sincronização Automática',
                                    '🔄 Tentando sincronizar automaticamente com o servidor...',
                                    4000
                                );
                            } else {
                                showToast(
                                    'warning',
                                    'Modo Offline',
                                    '📴 Sem conexão. Acesse o Painel Administrativo quando estiver online para sincronizar.',
                                    6000
                                );
                            }
                        }, 2000);
                    }

                } catch (error) {
                    console.error('Erro ao salvar:', error);
                    hideSyncModal();
                    
                    showToast(
                        'error',
                        'Erro ao Salvar',
                        `Não foi possível salvar o formulário: ${error.message}. Por favor, tente novamente.`,
                        8000
                    );
                } finally {
                    // Reabilitar botão
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            });

            // Inicializar barra de progresso
            updateProgressBar();
        });
    </script>
</body>
</html>







