================================================================================
         GUIA COMPLETO DE REPLICAÃ‡ÃƒO DO MAPA DE COBERTURA INTERATIVO
================================================================================

Data: 08/12/2025
Sistema: EMATECH - EMATER-RO
Arquivo Base: mapa-cobertura.html
Objetivo: Replicar mapa interativo com cobertura geogrÃ¡fica e estatÃ­sticas

================================================================================
ÃNDICE
================================================================================

1. VISÃƒO GERAL DO MAPA DE COBERTURA
2. ESTRUTURA HTML COMPLETA
3. BIBLIOTECAS E DEPENDÃŠNCIAS
4. DADOS GEOGRÃFICOS (GeoJSON)
5. ESTRUTURA DE DADOS
6. FUNCIONALIDADES PRINCIPAIS
7. PERSONALIZAÃ‡ÃƒO VISUAL
8. INTEGRAÃ‡ÃƒO COM API
9. PASSO A PASSO DE REPLICAÃ‡ÃƒO
10. EXEMPLOS DE CÃ“DIGO
11. TROUBLESHOOTING

================================================================================
1. VISÃƒO GERAL DO MAPA DE COBERTURA
================================================================================

PROPÃ“SITO:
----------
Visualizar geograficamente a cobertura das unidades EMATER-RO no estado,
mostrando:
- LocalizaÃ§Ã£o de todas as 83 unidades (ESREG, ESLOC)
- PolÃ­gonos dos 52 municÃ­pios de RondÃ´nia
- EstatÃ­sticas de cobertura por territÃ³rio
- Marcadores coloridos por tipo de unidade
- Filtros e busca interativa
- Dados de formulÃ¡rios coletados por municÃ­pio

COMPONENTES VISUAIS:
--------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HEADER                             â”‚
â”‚              Mapa EMATER-RO - Cobertura                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIDEBAR    â”‚            MAPA INTERATIVO                â”‚
â”‚             â”‚                                           â”‚
â”‚ EstatÃ­sticasâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Gerais      â”‚  â”‚  PolÃ­gonos dos MunicÃ­pios      â”‚       â”‚
â”‚             â”‚  â”‚  (coloridos por territÃ³rio)    â”‚       â”‚
â”‚ Filtros     â”‚  â”‚                                â”‚       â”‚
â”‚ - Todos     â”‚  â”‚  ğŸ¢ Marcadores das Unidades    â”‚       â”‚
â”‚ - ESREG     â”‚  â”‚  (Ã­cones por tipo)             â”‚       â”‚
â”‚ - ESLOC     â”‚  â”‚                                â”‚       â”‚
â”‚             â”‚  â”‚  ğŸ“ Popups com informaÃ§Ãµes     â”‚       â”‚
â”‚ Busca       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ [_______]   â”‚                                           â”‚
â”‚             â”‚  Controles:                               â”‚
â”‚ Lista de    â”‚  - Zoom in/out                            â”‚
â”‚ TerritÃ³rios â”‚  - Reset zoom                             â”‚
â”‚ - T1: ...   â”‚  - Legenda                                â”‚
â”‚ - T2: ...   â”‚  - Filtros                                â”‚
â”‚ - ...       â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FUNCIONALIDADES:
----------------
âœ… Mapa interativo com Leaflet.js
âœ… PolÃ­gonos de municÃ­pios (GeoJSON)
âœ… 83 marcadores de unidades EMATER
âœ… Cores por territÃ³rio (7 territÃ³rios)
âœ… Filtros por tipo (ESREG, ESLOC)
âœ… Busca por nome
âœ… EstatÃ­sticas dinÃ¢micas
âœ… Popups informativos
âœ… Destaque de municÃ­pios visitados (verde)
âœ… IntegraÃ§Ã£o com API de formulÃ¡rios
âœ… Reset de zoom
âœ… Legenda interativa

================================================================================
2. ESTRUTURA HTML COMPLETA
================================================================================

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Cobertura - [NOME DO SISTEMA]</title>
    
    <!-- Leaflet CSS (OBRIGATÃ“RIO) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* ESTILOS COMPLETOS AQUI */
    </style>
</head>
<body>
    <!-- Container Principal -->
    <div class="container">
        
        <!-- Header -->
        <div class="header">
            <h1>ğŸ—ºï¸ Mapa de Cobertura - [SISTEMA]</h1>
            <p>VisualizaÃ§Ã£o geogrÃ¡fica das unidades e cobertura</p>
        </div>
        
        <!-- ConteÃºdo Principal -->
        <div class="content">
            
            <!-- SIDEBAR ESQUERDA -->
            <div class="sidebar">
                
                <!-- EstatÃ­sticas Gerais -->
                <div class="stats">
                    <h3>ğŸ“Š EstatÃ­sticas Gerais</h3>
                    <div class="stat-item">
                        <span class="stat-label">Total de Unidades:</span>
                        <span class="stat-value" id="stat-total-unidades">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">MunicÃ­pios Cobertos:</span>
                        <span class="stat-value" id="stat-municipios-cobertos">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">FormulÃ¡rios Coletados:</span>
                        <span class="stat-value green" id="stat-formularios">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">MunicÃ­pios Visitados:</span>
                        <span class="stat-value green" id="stat-municipios-visitados">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Cobertura:</span>
                        <span class="stat-value orange" id="stat-cobertura">0%</span>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div class="filtros">
                    <h3>ğŸ” Filtros</h3>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-tipo="">
                            Todos
                        </button>
                        <button class="filter-btn" data-tipo="ESREG">
                            ESREG
                        </button>
                        <button class="filter-btn" data-tipo="ESLOC">
                            ESLOC
                        </button>
                    </div>
                </div>
                
                <!-- Busca -->
                <div class="busca">
                    <input type="text" 
                           id="search-input" 
                           placeholder="ğŸ” Buscar unidade..."
                           class="search-input">
                </div>
                
                <!-- Lista de TerritÃ³rios -->
                <div class="territorio-list" id="territorio-list">
                    <!-- Preenchido dinamicamente via JavaScript -->
                </div>
                
            </div>
            
            <!-- MAPA PRINCIPAL -->
            <div id="map"></div>
            
            <!-- BotÃ£o Reset Zoom (Sobreposto ao mapa) -->
            <button class="reset-zoom-btn" onclick="resetZoom()">
                <span class="reset-zoom-icon">ğŸ”„</span>
                <span>Resetar Zoom</span>
            </button>
            
        </div>
        
    </div>
    
    <!-- Leaflet JavaScript (OBRIGATÃ“RIO) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        /* JAVASCRIPT COMPLETO AQUI */
    </script>
</body>
</html>

================================================================================
3. BIBLIOTECAS E DEPENDÃŠNCIAS
================================================================================

LEAFLET.JS v1.9.4:
------------------
Biblioteca JavaScript para mapas interativos (open source)

CDN:
<!-- CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<!-- JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

DocumentaÃ§Ã£o: https://leafletjs.com/

RECURSOS USADOS:
- L.map() â†’ Criar mapa
- L.tileLayer() â†’ Camada de tiles (OpenStreetMap)
- L.marker() â†’ Marcadores de pontos
- L.geoJSON() â†’ PolÃ­gonos de municÃ­pios
- L.control() â†’ Controles customizados (legenda)
- L.divIcon() â†’ Ãcones HTML/CSS customizados

ARQUIVO GEOJSON:
----------------
Arquivo: geojs-11-mun.json
DescriÃ§Ã£o: PolÃ­gonos dos 52 municÃ­pios de RondÃ´nia (cÃ³digo IBGE 11)
Fonte: https://github.com/tbrugz/geodata-br

Estrutura:
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "id": "1100015",      // CÃ³digo IBGE
        "name": "Alta Floresta d'Oeste",
        "description": "Alta Floresta d'Oeste-RO, Brasil"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[lng, lat], [lng, lat], ...]]
      }
    }
  ]
}

Onde Encontrar:
1. GitHub: tbrugz/geodata-br
2. IBGE: https://www.ibge.gov.br/geociencias/
3. Nosso arquivo: DEPLOY_RAILWAY/geojs-11-mun.json

================================================================================
4. DADOS GEOGRÃFICOS (GeoJSON)
================================================================================

ESTRUTURA DO GEOJSON DE MUNICÃPIOS:
------------------------------------

{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "id": "1100015",           // CÃ³digo IBGE (string ou number)
        "name": "Alta Floresta d'Oeste",  // Nome do municÃ­pio
        "description": "...",
        // Pode ter outros campos: NOME, NM_MUN, etc.
      },
      "geometry": {
        "type": "Polygon",         // Ou "MultiPolygon"
        "coordinates": [
          [
            [-61.234567, -11.123456],  // [longitude, latitude]
            [-61.234568, -11.123457],
            // ... mais coordenadas
          ]
        ]
      }
    },
    // ... mais 51 municÃ­pios
  ]
}

CARREGAR GEOJSON NO MAPA:
--------------------------

fetch('geojs-11-mun.json')
    .then(response => response.json())
    .then(geoData => {
        L.geoJSON(geoData, {
            style: feature => {
                return {
                    color: '#555',        // Cor da borda
                    weight: 1,            // Espessura da borda
                    fillColor: '#A8D5E8', // Cor de preenchimento
                    fillOpacity: 0.4      // Opacidade
                };
            },
            onEachFeature: (feature, layer) => {
                // Adicionar popup
                const nome = feature.properties.name;
                layer.bindPopup(`<strong>${nome}</strong>`);
                
                // Eventos
                layer.on('mouseover', () => {
                    layer.setStyle({ fillOpacity: 0.7 });
                });
                layer.on('mouseout', () => {
                    layer.setStyle({ fillOpacity: 0.4 });
                });
            }
        }).addTo(map);
    })
    .catch(error => {
        console.error('Erro ao carregar GeoJSON:', error);
    });

IMPORTANTE:
-----------
- Coordenadas no GeoJSON: [longitude, latitude] (INVERSO do padrÃ£o!)
- CÃ³digo IBGE de RondÃ´nia: 11xxxxx (11 = RO)
- Total de municÃ­pios em RO: 52

================================================================================
5. ESTRUTURA DE DADOS
================================================================================

DADOS DAS UNIDADES (JavaScript Object):
----------------------------------------

const ematerData = {
    totalUnidades: 83,
    territorios: [
        {
            id: 1,
            nome: "TerritÃ³rio da Cidadania Portal da AmazÃ´nia",
            cor: "#FFB6C1",  // Rosa claro
            unidades: [
                {
                    id: 1,
                    tipo: "ESREG",  // ou "ESLOC"
                    nome: "Esreg de Ariquemes",
                    municipio: "Ariquemes",
                    latitude: -9.913300,
                    longitude: -63.040600,
                    codigo_ibge: 1100023,
                    ddd: 69,
                    distrito: null  // Opcional
                },
                {
                    id: 2,
                    tipo: "ESLOC",
                    nome: "Ariquemes",
                    municipio: "Ariquemes",
                    latitude: -9.908900,
                    longitude: -63.038900,
                    codigo_ibge: 1100023,
                    ddd: 69
                }
                // ... mais unidades
            ]
        },
        {
            id: 2,
            nome: "TerritÃ³rio da Cidadania Madeira-MamorÃ©",
            cor: "#F4A460",  // Laranja claro
            unidades: [
                // ...
            ]
        }
        // ... total de 7 territÃ³rios
    ]
};

TIPOS DE UNIDADES:
------------------
1. ESREG â†’ EscritÃ³rio Regional (maior hierarquia)
2. ESLOC â†’ EscritÃ³rio Local

CAMPOS OBRIGATÃ“RIOS:
--------------------
- id: NÃºmero Ãºnico
- tipo: "ESREG" ou "ESLOC"
- nome: Nome da unidade
- municipio: Nome do municÃ­pio
- latitude: Coordenada (decimal)
- longitude: Coordenada (decimal)
- codigo_ibge: CÃ³digo IBGE do municÃ­pio (number)

CAMPOS OPCIONAIS:
-----------------
- distrito: Nome do distrito (quando unidade nÃ£o Ã© na sede)
- ddd: CÃ³digo DDD
- telefone: Telefone da unidade
- email: E-mail
- endereco: EndereÃ§o completo

================================================================================
6. FUNCIONALIDADES PRINCIPAIS
================================================================================

FUNÃ‡ÃƒO 1: INICIALIZAR MAPA
---------------------------

// Criar mapa centrado em RondÃ´nia
const map = L.map('map').setView([-10.9, -62.8], 7);

// Adicionar camada de tiles (OpenStreetMap)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors',
    maxZoom: 18,
    minZoom: 6
}).addTo(map);

PARÃ‚METROS:
- setView([lat, lon], zoom)
  - lat/lon: Centro do mapa (RondÃ´nia: -10.9, -62.8)
  - zoom: NÃ­vel de zoom inicial (7 = estado inteiro)

FUNÃ‡ÃƒO 2: ADICIONAR MARCADORES
-------------------------------

function addMarkers() {
    ematerData.territorios.forEach(territorio => {
        territorio.unidades.forEach(unidade => {
            // Criar Ã­cone customizado
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="marker-${unidade.tipo.toLowerCase()}">
                           ${getEmojiPorTipo(unidade.tipo)}
                       </div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });
            
            // Criar marcador
            const marker = L.marker([unidade.latitude, unidade.longitude], {
                icon: icon
            });
            
            // Criar popup
            const popupContent = `
                <div class="popup-content">
                    <div class="popup-title">${unidade.nome}</div>
                    <div class="popup-info">
                        <strong>Tipo:</strong> ${unidade.tipo}<br>
                        <strong>MunicÃ­pio:</strong> ${unidade.municipio}<br>
                        <strong>TerritÃ³rio:</strong> ${territorio.nome}<br>
                        ${unidade.distrito ? `<strong>Distrito:</strong> ${unidade.distrito}<br>` : ''}
                        <strong>Coordenadas:</strong> ${unidade.latitude.toFixed(4)}, ${unidade.longitude.toFixed(4)}
                    </div>
                </div>
            `;
            
            marker.bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup'
            });
            
            // Adicionar ao mapa
            marker.addTo(map);
            
            // Armazenar referÃªncia
            markers.push(marker);
            markerGroups[unidade.tipo].push(marker);
        });
    });
}

FUNÃ‡ÃƒO 3: CARREGAR POLÃGONOS DOS MUNICÃPIOS
--------------------------------------------

let layerMunicipios = null;

fetch('geojs-11-mun.json')
    .then(r => r.json())
    .then(geoData => {
        layerMunicipios = L.geoJSON(geoData, {
            style: feature => {
                const municipio = feature.properties.name;
                const territorio = getTerritorioPorMunicipio(municipio);
                
                return {
                    color: '#555',
                    weight: 1,
                    fillColor: territorio ? territorio.cor : '#95a5a6',
                    fillOpacity: 0.4
                };
            },
            onEachFeature: (feature, layer) => {
                const nome = feature.properties.name;
                const codigoIbge = feature.properties.id;
                
                // Popup
                layer.bindPopup(`
                    <strong>${nome}</strong><br>
                    CÃ³digo IBGE: ${codigoIbge}
                `);
                
                // Hover effects
                layer.on('mouseover', () => {
                    layer.setStyle({ fillOpacity: 0.7, weight: 2 });
                });
                layer.on('mouseout', () => {
                    layer.setStyle({ fillOpacity: 0.4, weight: 1 });
                });
            }
        });
        
        layerMunicipios.addTo(map);
    })
    .catch(err => console.error('Erro ao carregar GeoJSON:', err));

FUNÃ‡ÃƒO 4: FILTRAR MARCADORES
-----------------------------

let activeFilter = '';
let searchTerm = '';

function applyFilters() {
    markers.forEach(marker => {
        const unidade = marker.unidade; // Armazenar referÃªncia na criaÃ§Ã£o
        
        // Filtro por tipo
        const passTypeFilter = !activeFilter || unidade.tipo === activeFilter;
        
        // Filtro por busca
        const passSearchFilter = !searchTerm || 
            unidade.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
            unidade.municipio.toLowerCase().includes(searchTerm.toLowerCase());
        
        // Mostrar/ocultar marcador
        if (passTypeFilter && passSearchFilter) {
            marker.addTo(map);
        } else {
            map.removeLayer(marker);
        }
    });
}

// Event listeners
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        activeFilter = btn.dataset.tipo;
        
        // Atualizar botÃµes ativos
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('active');
        });
        btn.classList.add('active');
        
        applyFilters();
    });
});

document.getElementById('search-input').addEventListener('input', (e) => {
    searchTerm = e.target.value;
    applyFilters();
});

FUNÃ‡ÃƒO 5: DESTACAR TERRITÃ“RIO
------------------------------

function focusTerritorioNoMapa(territorio) {
    // Calcular bounds (limites) das unidades do territÃ³rio
    const coords = territorio.unidades.map(u => [u.latitude, u.longitude]);
    
    if (coords.length === 0) return;
    
    const bounds = L.latLngBounds(coords);
    
    // Ajustar mapa para mostrar todas as unidades
    map.fitBounds(bounds, {
        padding: [50, 50],
        maxZoom: 10
    });
    
    // Destacar marcadores do territÃ³rio
    markers.forEach(marker => {
        const unidade = marker.unidade;
        const pertence = territorio.unidades.some(u => u.id === unidade.id);
        
        if (pertence) {
            marker.getElement().classList.add('marker-highlight');
        } else {
            marker.getElement().classList.add('marker-dimmed');
        }
    });
}

FUNÃ‡ÃƒO 6: RESET DE ZOOM
------------------------

const defaultView = {
    center: [-10.9, -62.8],
    zoom: 7
};

function resetZoom() {
    map.setView(defaultView.center, defaultView.zoom, {
        animate: true,
        duration: 0.5
    });
    
    // Remover destaques
    markers.forEach(marker => {
        marker.getElement().classList.remove('marker-highlight', 'marker-dimmed');
    });
}

FUNÃ‡ÃƒO 7: INTEGRAÃ‡ÃƒO COM API (FORMULÃRIOS)
-------------------------------------------

let formulariosPorMunicipio = {};

async function buscarEstatisticasCobertura() {
    try {
        const response = await fetch('./get-estatisticas-cobertura.php');
        const data = await response.json();
        
        if (data.success) {
            // Mapear formulÃ¡rios por municÃ­pio
            formulariosPorMunicipio = {};
            data.por_municipio.forEach(item => {
                formulariosPorMunicipio[item.municipio] = item.total;
            });
            
            // Atualizar estatÃ­sticas
            document.getElementById('stat-formularios').textContent = data.total_formularios;
            
            // Recolorir municÃ­pios visitados
            repintarMunicipios();
        }
    } catch (error) {
        console.error('Erro ao buscar estatÃ­sticas:', error);
    }
}

function municipioFoiVisitado(municipio) {
    return formulariosPorMunicipio[municipio] > 0;
}

function repintarMunicipios() {
    if (!layerMunicipios) return;
    
    layerMunicipios.eachLayer(layer => {
        const municipio = layer.feature.properties.name;
        const foiVisitado = municipioFoiVisitado(municipio);
        
        if (foiVisitado) {
            layer.setStyle({
                fillColor: '#27ae60',  // Verde
                fillOpacity: 0.6,
                weight: 2
            });
        }
    });
}

FUNÃ‡ÃƒO 8: CRIAR LEGENDA
-----------------------

const legend = L.control({ position: 'bottomright' });

legend.onAdd = function(map) {
    const div = L.DomUtil.create('div', 'legend');
    
    div.innerHTML = '<h4>Tipos de Unidade</h4>';
    
    const tipos = {
        'ESREG': 'ğŸ¢',
        'ESLOC': 'ğŸ '
    };
    
    Object.entries(tipos).forEach(([tipo, emoji]) => {
        div.innerHTML += `
            <div class="legend-item">
                <span style="font-size: 20px;">${emoji}</span>
                <span>${tipo}</span>
            </div>
        `;
    });
    
    return div;
};

legend.addTo(map);

FUNÃ‡ÃƒO 9: ESTATÃSTICAS DINÃ‚MICAS
---------------------------------

function updateStats() {
    // Total de unidades
    const totalUnidades = ematerData.totalUnidades;
    document.getElementById('stat-total-unidades').textContent = totalUnidades;
    
    // MunicÃ­pios com unidades
    const municipiosUnicos = new Set();
    ematerData.territorios.forEach(t => {
        t.unidades.forEach(u => municipiosUnicos.add(u.municipio));
    });
    document.getElementById('stat-municipios-cobertos').textContent = municipiosUnicos.size;
    
    // Cobertura percentual
    const cobertura = ((municipiosUnicos.size / 52) * 100).toFixed(1);
    document.getElementById('stat-cobertura').textContent = `${cobertura}%`;
    
    // MunicÃ­pios visitados
    const municipiosVisitados = Object.keys(formulariosPorMunicipio).length;
    document.getElementById('stat-municipios-visitados').textContent = municipiosVisitados;
}

================================================================================
7. PERSONALIZAÃ‡ÃƒO VISUAL
================================================================================

CSS PRINCIPAL:
--------------

/* Container do mapa */
#map {
    height: 100%;
    width: 100%;
    border-radius: 0 0 20px 0;
}

/* Sidebar */
.sidebar {
    background: #f8f9fa;
    padding: 20px;
    overflow-y: auto;
    border-right: 2px solid #e0e0e0;
}

/* Cards de estatÃ­sticas */
.stats {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e0e0e0;
}

.stat-value {
    color: #1e3c72;
    font-weight: bold;
}

.stat-value.green { color: #27ae60; }
.stat-value.red { color: #e74c3c; }
.stat-value.orange { color: #f39c12; }

/* BotÃµes de filtro */
.filter-btn {
    padding: 8px 15px;
    border: 2px solid #2a5298;
    background: white;
    color: #2a5298;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.filter-btn:hover,
.filter-btn.active {
    background: #2a5298;
    color: white;
}

/* Marcadores customizados */
.custom-marker {
    background: white;
    border: 2px solid #2a5298;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.custom-marker:hover {
    transform: scale(1.2);
    z-index: 1000;
}

.marker-highlight {
    filter: brightness(1.2) drop-shadow(0 0 10px #ffeb3b);
}

.marker-dimmed {
    opacity: 0.3;
}

/* Popups customizados */
.custom-popup .leaflet-popup-content-wrapper {
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.popup-title {
    font-size: 1.1em;
    font-weight: bold;
    color: #1e3c72;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 2px solid #2a5298;
}

.popup-info {
    font-size: 0.9em;
    color: #666;
    line-height: 1.6;
}

/* Legenda */
.legend {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.legend h4 {
    margin: 0 0 10px 0;
    font-size: 1em;
    color: #1e3c72;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

/* PolÃ­gonos dos municÃ­pios */
.municipio-polygon {
    transition: all 0.3s ease;
}

.municipio-visitado {
    fill: #27ae60 !important;
    fill-opacity: 0.6 !important;
    stroke-width: 2 !important;
}

/* Reset zoom button */
.reset-zoom-btn {
    position: absolute;
    top: 80px;
    right: 10px;
    z-index: 1000;
    background: white;
    border: 2px solid #2a5298;
    border-radius: 10px;
    padding: 12px 18px;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.reset-zoom-btn:hover {
    background: #2a5298;
    color: white;
    transform: translateY(-2px);
}

/* Responsividade */
@media (max-width: 1024px) {
    .content {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
    }
    
    .sidebar {
        max-height: 300px;
        border-right: none;
        border-bottom: 2px solid #e0e0e0;
    }
}

================================================================================
8. INTEGRAÃ‡ÃƒO COM API
================================================================================

API: GET-ESTATISTICAS-COBERTURA.PHP
------------------------------------

<?php
header('Content-Type: application/json; charset=utf-8');
require_once 'db-config.php';

try {
    // Total de formulÃ¡rios
    $sqlTotal = "SELECT COUNT(*) as total FROM formularios";
    $stmtTotal = $pdo->query($sqlTotal);
    $totalFormularios = $stmtTotal->fetch(PDO::FETCH_ASSOC)['total'];
    
    // FormulÃ¡rios por municÃ­pio
    $sqlPorMunicipio = "
        SELECT 
            municipio, 
            COUNT(*) as total 
        FROM formularios 
        GROUP BY municipio
    ";
    $stmtPorMunicipio = $pdo->query($sqlPorMunicipio);
    $porMunicipio = $stmtPorMunicipio->fetchAll(PDO::FETCH_ASSOC);
    
    // MunicÃ­pios Ãºnicos visitados
    $sqlMunicipiosVisitados = "
        SELECT COUNT(DISTINCT municipio) as total 
        FROM formularios
    ";
    $stmtMunicipiosVisitados = $pdo->query($sqlMunicipiosVisitados);
    $municipiosVisitados = $stmtMunicipiosVisitados->fetch(PDO::FETCH_ASSOC)['total'];
    
    // Com geolocalizaÃ§Ã£o
    $sqlComGeo = "
        SELECT COUNT(*) as total 
        FROM formularios 
        WHERE geolocalizacao_json IS NOT NULL
    ";
    $stmtComGeo = $pdo->query($sqlComGeo);
    $comGeolocalizacao = $stmtComGeo->fetch(PDO::FETCH_ASSOC)['total'];
    
    // Resposta
    echo json_encode([
        'success' => true,
        'total_formularios' => (int)$totalFormularios,
        'municipios_visitados' => (int)$municipiosVisitados,
        'com_geolocalizacao' => (int)$comGeolocalizacao,
        'por_municipio' => $porMunicipio,
        'timestamp' => date('Y-m-d H:i:s')
    ]);
    
} catch (Exception $e) {
    echo json_encode([
        'success' => false,
        'error' => $e->getMessage()
    ]);
}
?>

CHAMADA DA API NO JAVASCRIPT:
------------------------------

async function buscarEstatisticasCobertura() {
    try {
        showLoading('Carregando estatÃ­sticas...');
        
        const response = await fetch('./get-estatisticas-cobertura.php');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.error || 'Erro desconhecido');
        }
        
        console.log('âœ… EstatÃ­sticas carregadas:', data);
        
        // Atualizar variÃ¡veis globais
        formulariosPorMunicipio = {};
        data.por_municipio.forEach(item => {
            formulariosPorMunicipio[item.municipio] = parseInt(item.total);
        });
        
        // Atualizar UI
        document.getElementById('stat-formularios').textContent = data.total_formularios;
        document.getElementById('stat-municipios-visitados').textContent = data.municipios_visitados;
        
        // Repintar municÃ­pios
        repintarMunicipios();
        
        hideLoading();
        
    } catch (error) {
        console.error('âŒ Erro ao buscar estatÃ­sticas:', error);
        hideLoading();
        alert('Erro ao carregar estatÃ­sticas de cobertura.');
    }
}

================================================================================
9. PASSO A PASSO DE REPLICAÃ‡ÃƒO
================================================================================

CHECKLIST COMPLETO:
-------------------

â–¡ ETAPA 1: PREPARAÃ‡ÃƒO
   â–¡ Definir escopo do mapa (unidades, regiÃµes, etc)
   â–¡ Coletar coordenadas de todas as unidades
   â–¡ Obter arquivo GeoJSON dos polÃ­gonos (municÃ­pios/estados)
   â–¡ Definir cores dos territÃ³rios/regiÃµes
   â–¡ Listar KPIs e estatÃ­sticas necessÃ¡rias

â–¡ ETAPA 2: ESTRUTURA DE DADOS
   â–¡ Criar objeto JavaScript com dados das unidades
   â–¡ Estruturar territÃ³rios/regiÃµes
   â–¡ Validar coordenadas (lat, lon)
   â–¡ Adicionar cÃ³digos IBGE
   â–¡ Testar estrutura de dados

â–¡ ETAPA 3: HTML BASE
   â–¡ Criar arquivo mapa-[nome].html
   â–¡ Adicionar links do Leaflet CSS/JS
   â–¡ Criar estrutura: container â†’ sidebar + mapa
   â–¡ Adicionar elementos de UI:
      â–¡ Header
      â–¡ Cards de estatÃ­sticas
      â–¡ Filtros
      â–¡ Busca
      â–¡ Lista de territÃ³rios
      â–¡ Div do mapa (#map)
      â–¡ BotÃ£o de reset

â–¡ ETAPA 4: CSS
   â–¡ Copiar estilos base do mapa-cobertura.html
   â–¡ Ajustar cores do tema
   â–¡ Personalizar cards de estatÃ­sticas
   â–¡ Estilizar marcadores customizados
   â–¡ Estilizar popups
   â–¡ Adicionar responsividade

â–¡ ETAPA 5: JAVASCRIPT - INICIALIZAÃ‡ÃƒO
   â–¡ Inicializar mapa Leaflet
   â–¡ Adicionar tile layer (OpenStreetMap)
   â–¡ Definir centro e zoom inicial
   â–¡ Configurar limites do mapa (bounds)

â–¡ ETAPA 6: JAVASCRIPT - MARCADORES
   â–¡ Criar funÃ§Ã£o addMarkers()
   â–¡ Iterar sobre unidades
   â–¡ Criar Ã­cones customizados (divIcon)
   â–¡ Adicionar marcadores ao mapa
   â–¡ Criar popups informativos
   â–¡ Armazenar referÃªncias dos marcadores

â–¡ ETAPA 7: JAVASCRIPT - POLÃGONOS
   â–¡ Carregar arquivo GeoJSON via fetch()
   â–¡ Criar layer L.geoJSON()
   â–¡ Aplicar cores por territÃ³rio
   â–¡ Adicionar popups aos polÃ­gonos
   â–¡ Implementar hover effects
   â–¡ Adicionar ao mapa

â–¡ ETAPA 8: JAVASCRIPT - FILTROS
   â–¡ Implementar filtros por tipo
   â–¡ Adicionar busca por nome
   â–¡ Criar funÃ§Ã£o applyFilters()
   â–¡ Conectar event listeners
   â–¡ Testar todas as combinaÃ§Ãµes

â–¡ ETAPA 9: JAVASCRIPT - ESTATÃSTICAS
   â–¡ Calcular total de unidades
   â–¡ Contar municÃ­pios cobertos
   â–¡ Calcular cobertura percentual
   â–¡ Criar funÃ§Ã£o updateStats()
   â–¡ Atualizar cards da sidebar

â–¡ ETAPA 10: INTEGRAÃ‡ÃƒO COM API
   â–¡ Criar API PHP (get-estatisticas-cobertura.php)
   â–¡ Implementar queries SQL
   â–¡ Testar API individualmente
   â–¡ Criar funÃ§Ã£o buscarEstatisticasCobertura()
   â–¡ Integrar resposta da API
   â–¡ Repintar municÃ­pios visitados (verde)

â–¡ ETAPA 11: FUNCIONALIDADES EXTRAS
   â–¡ Reset de zoom
   â–¡ Destaque de territÃ³rio ao clicar
   â–¡ Legenda interativa
   â–¡ Tooltips informativos
   â–¡ Loading overlay
   â–¡ Tratamento de erros

â–¡ ETAPA 12: TESTES
   â–¡ Testar em diferentes navegadores
   â–¡ Validar responsividade mobile
   â–¡ Testar todos os filtros
   â–¡ Verificar performance (muitos marcadores)
   â–¡ Testar carregamento offline
   â–¡ Validar coordenadas (conferir no Google Maps)

â–¡ ETAPA 13: OTIMIZAÃ‡Ã•ES
   â–¡ Minificar GeoJSON (se muito grande)
   â–¡ Implementar lazy loading de marcadores
   â–¡ Adicionar clustering (se >100 marcadores)
   â–¡ Cachear dados da API
   â–¡ Otimizar CSS/JS

â–¡ ETAPA 14: DOCUMENTAÃ‡ÃƒO
   â–¡ Comentar cÃ³digo JavaScript
   â–¡ Documentar estrutura de dados
   â–¡ Criar README do mapa
   â–¡ Listar fontes de dados
   â–¡ Incluir instruÃ§Ãµes de manutenÃ§Ã£o

â–¡ ETAPA 15: DEPLOY
   â–¡ Commit no Git
   â–¡ Upload do GeoJSON
   â–¡ Configurar CORS (se necessÃ¡rio)
   â–¡ Testar em produÃ§Ã£o
   â–¡ Monitorar logs

================================================================================
10. EXEMPLOS DE CÃ“DIGO
================================================================================

EXEMPLO 1: MARCADOR CUSTOMIZADO COM EMOJI
------------------------------------------

function criarMarcadorCustomizado(unidade, territorio) {
    // Escolher emoji por tipo
    const emojis = {
        'ESREG': 'ğŸ¢',
        'ESLOC': 'ğŸ ',
        'SEDE': 'ğŸ›ï¸'
    };
    
    const emoji = emojis[unidade.tipo] || 'ğŸ“';
    
    // Criar Ã­cone
    const icon = L.divIcon({
        className: 'custom-marker',
        html: `
            <div class="marker-container" style="
                background: white;
                border: 3px solid ${territorio.cor};
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            ">
                ${emoji}
            </div>
        `,
        iconSize: [40, 40],
        iconAnchor: [20, 40],
        popupAnchor: [0, -40]
    });
    
    return icon;
}

EXEMPLO 2: POPUP RICO COM DADOS
--------------------------------

function criarPopupCompleto(unidade, territorio, formularios) {
    return `
        <div class="popup-rich">
            <div class="popup-header" style="
                background: linear-gradient(135deg, ${territorio.cor}dd 0%, ${territorio.cor}aa 100%);
                color: white;
                padding: 12px;
                margin: -10px -10px 10px -10px;
                border-radius: 8px 8px 0 0;
            ">
                <div style="font-size: 1.2em; font-weight: bold;">
                    ${unidade.nome}
                </div>
                <div style="font-size: 0.85em; opacity: 0.9;">
                    ${unidade.tipo} - ${unidade.municipio}
                </div>
            </div>
            
            <div class="popup-body">
                <div class="info-row">
                    <span class="label">ğŸ›ï¸ TerritÃ³rio:</span>
                    <span class="value">${territorio.nome}</span>
                </div>
                
                ${unidade.distrito ? `
                <div class="info-row">
                    <span class="label">ğŸ“ Distrito:</span>
                    <span class="value">${unidade.distrito}</span>
                </div>
                ` : ''}
                
                <div class="info-row">
                    <span class="label">ğŸ“‹ FormulÃ¡rios:</span>
                    <span class="value" style="color: ${formularios > 0 ? '#27ae60' : '#e74c3c'};">
                        ${formularios || 0}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="label">ğŸŒ Coordenadas:</span>
                    <span class="value">${unidade.latitude.toFixed(4)}, ${unidade.longitude.toFixed(4)}</span>
                </div>
                
                ${unidade.telefone ? `
                <div class="info-row">
                    <span class="label">ğŸ“ Telefone:</span>
                    <span class="value">${unidade.telefone}</span>
                </div>
                ` : ''}
            </div>
            
            <div class="popup-footer" style="
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid #e0e0e0;
                display: flex;
                gap: 8px;
            ">
                <button onclick="verDetalhesUnidade(${unidade.id})" style="
                    flex: 1;
                    padding: 6px 12px;
                    background: ${territorio.cor};
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                ">
                    Ver Detalhes
                </button>
                <button onclick="abrirNoGoogleMaps(${unidade.latitude}, ${unidade.longitude})" style="
                    flex: 1;
                    padding: 6px 12px;
                    background: #4285f4;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                ">
                    ğŸ—ºï¸ Google Maps
                </button>
            </div>
        </div>
    `;
}

EXEMPLO 3: FILTRO AVANÃ‡ADO COM MÃšLTIPLOS CRITÃ‰RIOS
---------------------------------------------------

const filtros = {
    tipo: '',
    territorio: '',
    temFormularios: false,
    busca: ''
};

function aplicarFiltrosAvancados() {
    markers.forEach(marker => {
        const unidade = marker.unidade;
        const territorio = marker.territorio;
        
        // CritÃ©rio 1: Tipo
        const passTipo = !filtros.tipo || unidade.tipo === filtros.tipo;
        
        // CritÃ©rio 2: TerritÃ³rio
        const passTerritorio = !filtros.territorio || territorio.id === filtros.territorio;
        
        // CritÃ©rio 3: Tem formulÃ¡rios?
        const formularios = formulariosPorMunicipio[unidade.municipio] || 0;
        const passFormularios = !filtros.temFormularios || formularios > 0;
        
        // CritÃ©rio 4: Busca
        const passBusca = !filtros.busca || 
            unidade.nome.toLowerCase().includes(filtros.busca.toLowerCase()) ||
            unidade.municipio.toLowerCase().includes(filtros.busca.toLowerCase());
        
        // Aplicar
        if (passTipo && passTerritorio && passFormularios && passBusca) {
            marker.addTo(map);
            marker.getElement().style.opacity = '1';
        } else {
            map.removeLayer(marker);
        }
    });
    
    // Atualizar contador
    const visiveis = markers.filter(m => map.hasLayer(m)).length;
    document.getElementById('contador-visiveis').textContent = `${visiveis} / ${markers.length}`;
}

EXEMPLO 4: CLUSTERING (Muitos Marcadores)
------------------------------------------

// Biblioteca: Leaflet.markercluster
// CDN: https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js

const markerCluster = L.markerClusterGroup({
    maxClusterRadius: 50,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    iconCreateFunction: function(cluster) {
        const count = cluster.getChildCount();
        
        return L.divIcon({
            html: `<div style="
                background: #2a5298;
                color: white;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 16px;
                border: 3px solid white;
                box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            ">${count}</div>`,
            className: 'marker-cluster-custom',
            iconSize: L.point(40, 40)
        });
    }
});

// Adicionar marcadores ao cluster
markers.forEach(marker => {
    markerCluster.addLayer(marker);
});

// Adicionar cluster ao mapa
map.addLayer(markerCluster);

EXEMPLO 5: HEATMAP DE FORMULÃRIOS
----------------------------------

// Biblioteca: Leaflet.heat
// CDN: https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js

function criarHeatmap() {
    const pontosCalor = [];
    
    ematerData.territorios.forEach(territorio => {
        territorio.unidades.forEach(unidade => {
            const formularios = formulariosPorMunicipio[unidade.municipio] || 0;
            
            if (formularios > 0) {
                pontosCalor.push([
                    unidade.latitude,
                    unidade.longitude,
                    formularios / 10  // Intensidade (normalizar)
                ]);
            }
        });
    });
    
    const heatLayer = L.heatLayer(pontosCalor, {
        radius: 25,
        blur: 15,
        maxZoom: 10,
        max: 1.0,
        gradient: {
            0.0: 'blue',
            0.5: 'yellow',
            1.0: 'red'
        }
    });
    
    heatLayer.addTo(map);
}

EXEMPLO 6: EXPORTAR MAPA COMO IMAGEM
-------------------------------------

// Biblioteca: leaflet-image
// CDN: https://unpkg.com/leaflet-image@0.4.0/leaflet-image.js

function exportarMapaComoImagem() {
    leafletImage(map, function(err, canvas) {
        if (err) {
            console.error('Erro ao exportar:', err);
            return;
        }
        
        // Converter para PNG
        const img = canvas.toDataURL('image/png');
        
        // Download
        const a = document.createElement('a');
        a.href = img;
        a.download = `mapa_cobertura_${new Date().toISOString().split('T')[0]}.png`;
        a.click();
    });
}

EXEMPLO 7: ANIMAÃ‡ÃƒO DE MARCADORES
----------------------------------

function animarMarcadores() {
    markers.forEach((marker, index) => {
        setTimeout(() => {
            // Bounce animation
            marker.setZIndexOffset(1000);
            
            const element = marker.getElement();
            element.style.animation = 'bounce 0.5s ease';
            
            // Abrir popup temporariamente
            setTimeout(() => {
                marker.openPopup();
            }, 250);
            
            setTimeout(() => {
                marker.closePopup();
                element.style.animation = '';
                marker.setZIndexOffset(0);
            }, 1500);
            
        }, index * 100);  // Delay progressivo
    });
}

// CSS para animaÃ§Ã£o
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

EXEMPLO 8: ROTA ENTRE DOIS PONTOS
----------------------------------

// Biblioteca: Leaflet Routing Machine
// CDN: https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js

function tracarRota(pontoA, pontoB) {
    L.Routing.control({
        waypoints: [
            L.latLng(pontoA.latitude, pontoA.longitude),
            L.latLng(pontoB.latitude, pontoB.longitude)
        ],
        routeWhileDragging: true,
        lineOptions: {
            styles: [{ color: '#2a5298', weight: 4 }]
        },
        createMarker: function() { return null; }  // Sem marcadores extras
    }).addTo(map);
}

================================================================================
11. TROUBLESHOOTING
================================================================================

PROBLEMA 1: Mapa nÃ£o aparece (sÃ³ fundo cinza)
----------------------------------------------
CAUSA: Leaflet CSS nÃ£o carregado ou div sem altura
SOLUÃ‡ÃƒO:
- Verificar se CSS do Leaflet foi incluÃ­do ANTES do </head>
- Adicionar altura fixa ao #map: height: 600px;
- Chamar map.invalidateSize() apÃ³s mostrar mapa

PROBLEMA 2: Marcadores nÃ£o aparecem
------------------------------------
CAUSA: Coordenadas invertidas ou fora dos limites
SOLUÃ‡ÃƒO:
- Verificar se latitude estÃ¡ entre -90 e 90
- Verificar se longitude estÃ¡ entre -180 e 180
- Conferir ordem: L.marker([LATITUDE, LONGITUDE])
- Validar dados no console: console.log(unidade)

PROBLEMA 3: GeoJSON nÃ£o carrega
--------------------------------
CAUSA: Arquivo nÃ£o encontrado ou CORS
SOLUÃ‡ÃƒO:
- Verificar caminho do arquivo (relativo ou absoluto)
- Abrir arquivo no navegador para testar
- Configurar CORS no servidor
- Usar servidor local (Live Server no VSCode)

PROBLEMA 4: PolÃ­gonos nÃ£o coloridos corretamente
-------------------------------------------------
CAUSA: NormalizaÃ§Ã£o de nomes ou cÃ³digos IBGE
SOLUÃ‡ÃƒO:
- Criar funÃ§Ã£o de normalizaÃ§Ã£o:
  function normalizar(str) {
      return str.normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toLowerCase()
                .trim();
  }
- Usar cÃ³digo IBGE (mais confiÃ¡vel)
- Logar nomes para debug

PROBLEMA 5: Performance ruim (muitos marcadores)
-------------------------------------------------
CAUSA: Muitos marcadores renderizados simultaneamente
SOLUÃ‡ÃƒO:
- Implementar clustering (Leaflet.markercluster)
- Lazy loading de marcadores
- Remover marcadores fora da viewport
- Simplificar Ã­cones (usar CSS puro)

PROBLEMA 6: Zoom muito lento
-----------------------------
CAUSA: PolÃ­gonos complexos ou muitas features
SOLUÃ‡ÃƒO:
- Simplificar GeoJSON (reduzir pontos)
- Usar ferramenta: mapshaper.org
- Adicionar debounce nos eventos
- Desabilitar animaÃ§Ãµes: { animate: false }

PROBLEMA 7: API nÃ£o retorna dados
----------------------------------
CAUSA: CORS, caminho errado ou erro no PHP
SOLUÃ‡ÃƒO:
- Testar API diretamente no navegador
- Verificar CORS headers no PHP
- Conferir logs do servidor (error_log)
- Validar JSON da resposta (jsonlint.com)

PROBLEMA 8: Popups cortados na tela
------------------------------------
CAUSA: maxWidth pequeno ou posicionamento
SOLUÃ‡ÃƒO:
- Aumentar maxWidth: { maxWidth: 400 }
- Ajustar autoPan: { autoPan: true }
- Usar autoPanPadding: { autoPanPadding: [50, 50] }

PROBLEMA 9: Ãcones nÃ£o aparecem corretamente
---------------------------------------------
CAUSA: Caminho de imagens errado no Leaflet
SOLUÃ‡ÃƒO:
- Usar divIcon com HTML/CSS (mais confiÃ¡vel)
- Configurar iconUrl com caminho absoluto
- Verificar console para erros 404

PROBLEMA 10: Mapa nÃ£o responsivo em mobile
-------------------------------------------
CAUSA: Falta de meta viewport ou CSS inadequado
SOLUÃ‡ÃƒO:
- Adicionar: <meta name="viewport" content="width=device-width">
- Usar CSS Grid/Flexbox responsivo
- Testar com DevTools (modo mobile)
- Adicionar touch handlers: { tap: true }

================================================================================
RECURSOS E REFERÃŠNCIAS
================================================================================

DOCUMENTAÃ‡ÃƒO OFICIAL:
----------------------
- Leaflet.js: https://leafletjs.com/reference.html
- OpenStreetMap: https://www.openstreetmap.org/
- GeoJSON Spec: https://geojson.org/

FERRAMENTAS ÃšTEIS:
------------------
- Mapshaper: https://mapshaper.org/ (simplificar GeoJSON)
- GeoJSON.io: http://geojson.io/ (editor visual)
- JSON Lint: https://jsonlint.com/ (validar JSON)
- Leaflet Plugins: https://leafletjs.com/plugins.html

DADOS GEOGRÃFICOS:
------------------
- IBGE: https://www.ibge.gov.br/geociencias/
- Natural Earth: https://www.naturalearthdata.com/
- GitHub tbrugz/geodata-br: Dados do Brasil

BIBLIOTECAS EXTRAS:
-------------------
- Leaflet.markercluster: Agrupamento de marcadores
- Leaflet.heat: Mapas de calor
- Leaflet Routing Machine: Rotas
- leaflet-image: Exportar como imagem

TUTORIAIS:
----------
- Leaflet Quick Start: https://leafletjs.com/examples/quick-start/
- GeoJSON with Leaflet: https://leafletjs.com/examples/geojson/
- Custom Icons: https://leafletjs.com/examples/custom-icons/

================================================================================
NOTAS FINAIS
================================================================================

PERFORMANCE:
------------
- Use clustering para >100 marcadores
- Simplifique GeoJSON (menos de 1MB)
- Cache dados da API (localStorage)
- Debounce em eventos de zoom/pan

ACESSIBILIDADE:
---------------
- Adicione labels aos controles
- Use contraste adequado nas cores
- Implemente navegaÃ§Ã£o por teclado
- Teste com screen readers

MANUTENÃ‡ÃƒO:
-----------
- Documente estrutura de dados
- Versione arquivo GeoJSON
- Comente cÃ³digo JavaScript
- Mantenha backup dos dados

BOA SORTE NA REPLICAÃ‡ÃƒO! ğŸ—ºï¸
================================================================================
